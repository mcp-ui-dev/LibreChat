import { formatToolContent } from '../parsers';
import type * as t from '../types';

describe('formatToolContent', () => {
  /**
   * The tests below use real world data from 3 different MCP Servers sending UI Resources.
   * This is necessary since tweaks had to be made in the parser to accomodate
   *   different spec-implementing servers.
   */
  describe('UI Resources encoding', () => {
    it('should properly encode a tool call response with a simple ui resource url based and no text resource', () => {
      const result = {
        "content": [
          {
            "type": "resource",
            "resource": {
              "uri": "ui://task-manager/1756740395145",
              "mimeType": "text/uri-list",
              "text": "https://remote-mcp-server-authless.idosalomon.workers.dev/task"
            }
          }
        ]
      } as t.MCPToolCallResponse;
      const provider = 'openai' as t.Provider;

      const [formattedContent, artifacts] = formatToolContent(result, provider);
      
      expect(formattedContent).toEqual([
        {
          type: 'text',
          metadata: 'ui_resources',
          text: 'W3sidXJpIjoidWk6Ly90YXNrLW1hbmFnZXIvMTc1Njc0MDM5NTE0NSIsIm1pbWVUeXBlIjoidGV4dC91cmktbGlzdCIsInRleHQiOiJodHRwczovL3JlbW90ZS1tY3Atc2VydmVyLWF1dGhsZXNzLmlkb3NhbG9tb24ud29ya2Vycy5kZXYvdGFzayJ9XQ=='
        }
      ]);
      expect(artifacts).toEqual(undefined);
    });

    it('should properly encode a tool call response with a text content containing nested object and a ui resource with url', () => {
      const result = {
        "content": [
          {
            "type": "text",
            "text": "{\"products\":[{\"product_id\":\"gid://shopify/Product/7091621527632\",\"title\":\"Men's Tree Runner - Blizzard/Bold Red (Blizzard Sole)\",\"url\":\"https://www.allbirds.com/products/mens-tree-runners-blizzard-bold-red\",\"price_range\":{\"min\":\"68.0\",\"max\":\"68.0\",\"currency\":\"USD\"},\"product_type\":\"Shoes\",\"variants\":[{\"variant_id\":\"gid://shopify/ProductVariant/40873689874512\",\"title\":\"8\",\"price\":\"68.0\",\"currency\":\"USD\",\"available\":true},{\"variant_id\":\"gid://shopify/ProductVariant/40873689907280\",\"title\":\"9\",\"price\":\"68.0\",\"currency\":\"USD\",\"available\":true},{\"variant_id\":\"gid://shopify/ProductVariant/40873689940048\",\"title\":\"10\",\"price\":\"68.0\",\"currency\":\"USD\",\"available\":true},{\"variant_id\":\"gid://shopify/ProductVariant/40873689972816\",\"title\":\"11\",\"price\":\"68.0\",\"currency\":\"USD\",\"available\":true},{\"variant_id\":\"gid://shopify/ProductVariant/40873690005584\",\"title\":\"12\",\"price\":\"68.0\",\"currency\":\"USD\",\"available\":true},{\"variant_id\":\"gid://shopify/ProductVariant/40873690038352\",\"title\":\"13\",\"price\":\"68.0\",\"currency\":\"USD\",\"available\":true},{\"variant_id\":\"gid://shopify/ProductVariant/40873690071120\",\"title\":\"14\",\"price\":\"68.0\",\"currency\":\"USD\",\"available\":true}]}],\"pagination\":{\"hasNextPage\":false,\"hasPreviousPage\":false,\"startCursor\":\"eyJwYWdlIjoxLCJsYXN0X2lkIjo3MDkxNjIxNTI3NjMyLCJyZXZlcnNlIjp0cnVlLCJvZmZzZXQiOjB9\",\"endCursor\":null,\"currentPage\":1,\"nextPage\":null,\"maxPages\":2500,\"limitReached\":false},\"available_filters\":[{\"label\":\"Size\",\"values\":{\"label\":[\"8\",\"8.5\",\"9\",\"9.5\",\"10\",\"10.5\",\"11\",\"11.5\",\"12\",\"12.5\",\"13\",\"13.5\",\"14\",\"15\"],\"input_options\":[{\"label\":\"8\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"8\"}}},{\"label\":\"8.5\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"8.5\"}}},{\"label\":\"9\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"9\"}}},{\"label\":\"9.5\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"9.5\"}}},{\"label\":\"10\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"10\"}}},{\"label\":\"10.5\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"10.5\"}}},{\"label\":\"11\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"11\"}}},{\"label\":\"11.5\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"11.5\"}}},{\"label\":\"12\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"12\"}}},{\"label\":\"12.5\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"12.5\"}}},{\"label\":\"13\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"13\"}}},{\"label\":\"13.5\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"13.5\"}}},{\"label\":\"14\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"14\"}}},{\"label\":\"15\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_sizes\",\"value\":\"15\"}}}]}},{\"label\":\"Product Types\",\"values\":{\"label\":[\"Everyday Sneakers\",\"Running Shoes\"],\"input_options\":[{\"label\":\"Everyday Sneakers\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_subtypes\",\"value\":\"Everyday Sneakers\"}}},{\"label\":\"Running Shoes\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_subtypes\",\"value\":\"Running Shoes\"}}}]}},{\"label\":\"Material\",\"values\":{\"label\":[\"tree\"],\"input_options\":[{\"label\":\"tree\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_material\",\"value\":\"tree\"}}}]}},{\"label\":\"Utility\",\"values\":{\"label\":[\"everyday\",\"running\",\"warm-weather\"],\"input_options\":[{\"label\":\"everyday\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_utility\",\"value\":\"everyday\"}}},{\"label\":\"running\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_utility\",\"value\":\"running\"}}},{\"label\":\"warm-weather\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_utility\",\"value\":\"warm-weather\"}}}]}},{\"label\":\"Price\",\"values\":{\"label\":[\"Price\"],\"input_options\":[{\"label\":\"Price\",\"input\":{\"price\":{\"min\":0,\"max\":68}}}]}},{\"label\":\"Color\",\"values\":{\"label\":[\"blue\",\"red\",\"white\"],\"input_options\":[{\"label\":\"blue\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_hues\",\"value\":\"blue\"}}},{\"label\":\"red\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_hues\",\"value\":\"red\"}}},{\"label\":\"white\",\"input\":{\"productMetafield\":{\"namespace\":\"allbirds_v2\",\"key\":\"category_hues\",\"value\":\"white\"}}}]}}],\"instructions\":\"Use markdown to render product titles as links to their respective product pages using the URL property.\\n\\nFor product data:\\n- If variants are included in the response, those are the only variants available\\n- If variants are not included, use the options and availability matrix with get_product_details tool\\n- Check product_type, tags, and other properties to help the user find what they need\\n\\nFor filters:\\n- Mention available filters to the user if they might be helpful\\n- Use filters ONLY from available_filters in follow-up searches\\n- If a search term matches a filter, do a follow-up search with the filter applied\\n\\nFor pagination:\\n- Show only the first set of results initially\\n- If pagination.hasNextPage is true, ask if the user wants to see more\\n- Only fetch additional pages when explicitly requested\\n\"}"
          },
          {
            "type": "resource",
            "resource": {
              "uri": "ui://product/gid://shopify/Product/7091621527632",
              "mimeType": "text/uri-list",
              "text": "https://mcpstorefront.com/img/storefront/product.component.html?store_domain=allbirds.com&product_handle=mens-tree-runners-blizzard-bold-red&product_id=gid://shopify/Product/7091621527632&mode=tool"
            }
          }
        ],
        "isError": false
      } as t.MCPToolCallResponse;
      const provider = 'openai' as t.Provider;

      const [formattedContent, artifacts] = formatToolContent(result, provider);
      
      expect(formattedContent).toEqual([
        {
          type: 'text',
          text: `{"products":[{"product_id":"gid://shopify/Product/7091621527632","title":"Men's Tree Runner - Blizzard/Bold Red (Blizzard Sole)","url":"https://www.allbirds.com/products/mens-tree-runners-blizzard-bold-red","price_range":{"min":"68.0","max":"68.0","currency":"USD"},"product_type":"Shoes","variants":[{"variant_id":"gid://shopify/ProductVariant/40873689874512","title":"8","price":"68.0","currency":"USD","available":true},{"variant_id":"gid://shopify/ProductVariant/40873689907280","title":"9","price":"68.0","currency":"USD","available":true},{"variant_id":"gid://shopify/ProductVariant/40873689940048","title":"10","price":"68.0","currency":"USD","available":true},{"variant_id":"gid://shopify/ProductVariant/40873689972816","title":"11","price":"68.0","currency":"USD","available":true},{"variant_id":"gid://shopify/ProductVariant/40873690005584","title":"12","price":"68.0","currency":"USD","available":true},{"variant_id":"gid://shopify/ProductVariant/40873690038352","title":"13","price":"68.0","currency":"USD","available":true},{"variant_id":"gid://shopify/ProductVariant/40873690071120","title":"14","price":"68.0","currency":"USD","available":true}]}],"pagination":{"hasNextPage":false,"hasPreviousPage":false,"startCursor":"eyJwYWdlIjoxLCJsYXN0X2lkIjo3MDkxNjIxNTI3NjMyLCJyZXZlcnNlIjp0cnVlLCJvZmZzZXQiOjB9","endCursor":null,"currentPage":1,"nextPage":null,"maxPages":2500,"limitReached":false},"available_filters":[{"label":"Size","values":{"label":["8","8.5","9","9.5","10","10.5","11","11.5","12","12.5","13","13.5","14","15"],"input_options":[{"label":"8","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"8"}}},{"label":"8.5","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"8.5"}}},{"label":"9","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"9"}}},{"label":"9.5","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"9.5"}}},{"label":"10","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"10"}}},{"label":"10.5","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"10.5"}}},{"label":"11","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"11"}}},{"label":"11.5","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"11.5"}}},{"label":"12","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"12"}}},{"label":"12.5","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"12.5"}}},{"label":"13","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"13"}}},{"label":"13.5","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"13.5"}}},{"label":"14","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"14"}}},{"label":"15","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_sizes","value":"15"}}}]}},{"label":"Product Types","values":{"label":["Everyday Sneakers","Running Shoes"],"input_options":[{"label":"Everyday Sneakers","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_subtypes","value":"Everyday Sneakers"}}},{"label":"Running Shoes","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_subtypes","value":"Running Shoes"}}}]}},{"label":"Material","values":{"label":["tree"],"input_options":[{"label":"tree","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_material","value":"tree"}}}]}},{"label":"Utility","values":{"label":["everyday","running","warm-weather"],"input_options":[{"label":"everyday","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_utility","value":"everyday"}}},{"label":"running","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_utility","value":"running"}}},{"label":"warm-weather","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_utility","value":"warm-weather"}}}]}},{"label":"Price","values":{"label":["Price"],"input_options":[{"label":"Price","input":{"price":{"min":0,"max":68}}}]}},{"label":"Color","values":{"label":["blue","red","white"],"input_options":[{"label":"blue","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_hues","value":"blue"}}},{"label":"red","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_hues","value":"red"}}},{"label":"white","input":{"productMetafield":{"namespace":"allbirds_v2","key":"category_hues","value":"white"}}}]}}],"instructions":"Use markdown to render product titles as links to their respective product pages using the URL property.\\n\\nFor product data:\\n- If variants are included in the response, those are the only variants available\\n- If variants are not included, use the options and availability matrix with get_product_details tool\\n- Check product_type, tags, and other properties to help the user find what they need\\n\\nFor filters:\\n- Mention available filters to the user if they might be helpful\\n- Use filters ONLY from available_filters in follow-up searches\\n- If a search term matches a filter, do a follow-up search with the filter applied\\n\\nFor pagination:\\n- Show only the first set of results initially\\n- If pagination.hasNextPage is true, ask if the user wants to see more\\n- Only fetch additional pages when explicitly requested\\n"}`
        },
        {
          type: 'text',
          metadata: 'ui_resources',
          text: 'W3sidXJpIjoidWk6Ly9wcm9kdWN0L2dpZDovL3Nob3BpZnkvUHJvZHVjdC83MDkxNjIxNTI3NjMyIiwibWltZVR5cGUiOiJ0ZXh0L3VyaS1saXN0IiwidGV4dCI6Imh0dHBzOi8vbWNwc3RvcmVmcm9udC5jb20vaW1nL3N0b3JlZnJvbnQvcHJvZHVjdC5jb21wb25lbnQuaHRtbD9zdG9yZV9kb21haW49YWxsYmlyZHMuY29tJnByb2R1Y3RfaGFuZGxlPW1lbnMtdHJlZS1ydW5uZXJzLWJsaXp6YXJkLWJvbGQtcmVkJnByb2R1Y3RfaWQ9Z2lkOi8vc2hvcGlmeS9Qcm9kdWN0LzcwOTE2MjE1Mjc2MzImbW9kZT10b29sIn1d'
        }
      ]);
      expect(artifacts).toEqual(undefined);
    });

    it('should properly encode a tool call response with 2 resources, one containing text data and the second the UI resource with the HTML to render', () => {
      const result = {
        "content": [
          {
            "type": "resource",
            "resource": {
              "uri": "http://mcp-aharvard/weather-data",
              "mimeType": "application/json",
              "text": "{\"location\":\"Paris\",\"temperature\":69,\"unit\":\"¬∞F\",\"condition\":\"Partly Cloudy\",\"humidity\":55,\"windSpeed\":8,\"windUnit\":\"mph\",\"description\":\"Current weather in Paris\"}"
            }
          },
          {
            "type": "resource",
            "resource": {
              "uri": "ui://mcp-aharvard/weather-card",
              "mimeType": "text/html",
              "text": "\n<style>\n  * {\n    box-sizing: border-box;\n  }\n  :root {\n    font-family: Inter, sans-serif;\n    font-feature-settings: 'liga' 1, 'calt' 1; /* fix for Chrome */\n    --card-background-color: #000000;\n    --card-text-color: #ffffff;\n  }\n  @supports (font-variation-settings: normal) {\n    :root { font-family: InterVariable, sans-serif; }\n  }\n  html, body {\n   overflow: hidden;\n  }\n  body {\n    margin: 0;\n    padding: 0;\n    background-color: transparent;\n    display: grid;\n  }\n  .mcp-ui-container{\n    // max-width: 700px; \n    container-type: inline-size;\n    container-name: weather-card;\n  }\n \n  .weather-card {\n    margin: 10px;\n    position: relative;\n    color: var(--card-text-color);\n    padding: 30px 30px 40px 30px;\n    border-radius: 4px;\n    box-shadow: 0 0 0 10px rgba(255, 255, 255, .15);\n    display: grid;\n    gap: 8px;\n    grid-template-columns: 1fr;\n    overflow: hidden;\n    grid-template-areas:\n      \"location\"\n      \"temperature\"\n      \"condition-container \"\n  }\n  .weather-card * {\n    margin: 0;\n    line-height: 1;\n  }\n  .location {\n    font-size: 48px;\n    font-weight: 700;\n    grid-area: location;\n  }\n  .temperature {\n    grid-area: temperature;\n    display: flex;\n    align-items: top;\n    margin-bottom: 15px;\n  }\n  .temperature-value {\n    font-weight: 900;\n    font-size: 30cqw;\n    line-height: 0.8;\n    transform: translateY(10px);\n    filter: drop-shadow(0 2px 1px rgba(120, 120, 120, 0.25));\n  }\n  .temperature-unit {\n    font-size: 30px;\n    margin-top: 8px;\n  }\n  .weather-condition-container{\n    text-transform: uppercase;\n    font-size: 14px;\n    font-weight: 500;\n    letter-spacing: 0.05em;\n    align-self: flex-end;\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    grid-area: condition-container;\n  }\n  .condition {\n    font-size: 18px;\n    font-weight: 800;\n    margin-bottom: 4px;\n  }\n  .wind-speed,\n  .humidity {\n    font-size: 14px;\n    font-weight: 2500;\n    letter-spacing: 0.05em;\n    opacity: 0.75;  \n  }\n  \n    /* Rotating gradient animation using pseudo-element */\n  @keyframes rotateGradient {\n    0% {\n      transform: rotate(-60deg);\n      scale: 1;\n    }\n    100% {\n      transform: rotate(0deg);\n      scale: 1.5;\n    }\n  }\n  \n  /* Pseudo-element for animated gradient background */\n  .weather-card::before {\n    content: '';\n    position: absolute;\n    --size: 200%;\n    top: -50cqw;\n    left: calc(50% - var(--size) / 2);\n    width: var(--size);\n    aspect-ratio: 1/1;\n    transform-origin: center;\n    z-index: -1;\n    background: linear-gradient(135deg, var(--gradient-color-1), var(--gradient-color-2), var(--gradient-color-3));\n    animation: rotateGradient 3s ease-in-out infinite alternate;\n  }\n  \n  /* Clear and Sunny Conditions */\n  .weather-condition-clear-sky {\n    --gradient-color-1: #1e90ff;\n    --gradient-color-2: #00bfff;\n    --gradient-color-3: #87ceeb;\n    --card-text-color: #e6f3ff;\n  }\n  .weather-condition-mainly-clear {\n    --gradient-color-1: #87ceeb;\n    --gradient-color-2: #b0e0e6;\n    --gradient-color-3: #f0f8ff;\n    --card-text-color: #1a3c4a;\n  }\n  .weather-condition-partly-cloudy {\n    --gradient-color-1: #87ceeb;\n    --gradient-color-2: #b0e0e6;\n    --gradient-color-3: #f0f8ff;\n    --card-text-color: #1a3c4a;\n  }\n  .weather-condition-overcast {\n    --gradient-color-1: #708090;\n    --gradient-color-2: #778899;\n    --gradient-color-3: #b0c4de;\n    --card-text-color: #e8f0f8;\n  }\n\n  /* Fog Conditions */\n  .weather-condition-fog {\n    --gradient-color-1: #d3d3d3;\n    --gradient-color-2: #e6e6e6;\n    --gradient-color-3: #f5f5f5;\n    --card-text-color: #2d2d2d;\n  }\n  .weather-condition-depositing-rime-fog {\n    --gradient-color-1: #d3d3d3;\n    --gradient-color-2: #e6e6e6;\n    --gradient-color-3: #f5f5f5;\n    --card-text-color: #2d2d2d;\n  }\n\n  /* Drizzle Conditions */\n  .weather-condition-light-drizzle {\n    --gradient-color-1: #5f9ea0;\n    --gradient-color-2: #7fb3d3;\n    --gradient-color-3: #b0e0e6;\n    --card-text-color: #e6f7ff;\n  }\n  .weather-condition-moderate-drizzle {\n    --gradient-color-1: #5f9ea0;\n    --gradient-color-2: #7fb3d3;\n    --gradient-color-3: #b0e0e6;\n    --card-text-color: #e6f7ff;\n  }\n  .weather-condition-dense-drizzle {\n    --gradient-color-1: #5f9ea0;\n    --gradient-color-2: #7fb3d3;\n    --gradient-color-3: #b0e0e6;\n    --card-text-color: #e6f7ff;\n  }\n  .weather-condition-light-freezing-drizzle {\n    --gradient-color-1: #4682b4;\n    --gradient-color-2: #5f9ea0;\n    --gradient-color-3: #b0c4de;\n    --card-text-color: #e6f3ff;\n  }\n  .weather-condition-dense-freezing-drizzle {\n    --gradient-color-1: #4682b4;\n    --gradient-color-2: #5f9ea0;\n    --gradient-color-3: #b0c4de;\n    --card-text-color: #e6f3ff;\n  }\n\n  /* Rain Conditions */\n  .weather-condition-slight-rain {\n    --gradient-color-1: #4682b4;\n    --gradient-color-2: #5f9ea0;\n    --gradient-color-3: #87ceeb;\n    --card-text-color: #e6f3ff;\n  }\n  .weather-condition-moderate-rain {\n    --gradient-color-1: #4682b4;\n    --gradient-color-2: #5f9ea0;\n    --gradient-color-3: #87ceeb;\n    --card-text-color: #e6f3ff;\n  }\n  .weather-condition-heavy-rain {\n    --gradient-color-1: #191970;\n    --gradient-color-2: #4169e1;\n    --gradient-color-3: #1e90ff;\n    --card-text-color: #e6f3ff;\n  }\n  .weather-condition-light-freezing-rain {\n    --gradient-color-1: #4682b4;\n    --gradient-color-2: #5f9ea0;\n    --gradient-color-3: #b0c4de;\n    --card-text-color: #e6f3ff;\n  }\n  .weather-condition-heavy-freezing-rain {\n    --gradient-color-1: #4682b4;\n    --gradient-color-2: #5f9ea0;\n    --gradient-color-3: #b0c4de;\n    --card-text-color: #e6f3ff;\n  }\n\n  /* Snow Conditions */\n  .weather-condition-slight-snow {\n    --gradient-color-1: #f0f8ff;\n    --gradient-color-2: #e6e6fa;\n    --gradient-color-3: #ffffff;\n    --card-text-color: #1a1a2e;\n  }\n  .weather-condition-moderate-snow {\n    --gradient-color-1: #f0f8ff;\n    --gradient-color-2: #e6e6fa;\n    --gradient-color-3: #ffffff;\n    --card-text-color: #1a1a2e;\n  }\n  .weather-condition-heavy-snow {\n    --gradient-color-1: #f0f8ff;\n    --gradient-color-2: #e6e6fa;\n    --gradient-color-3: #ffffff;\n    --card-text-color: #1a1a2e;\n  }\n  .weather-condition-snow-grains {\n    --gradient-color-1: #f0f8ff;\n    --gradient-color-2: #e6e6fa;\n    --gradient-color-3: #ffffff;\n    --card-text-color: #1a1a2e;\n  }\n\n  /* Rain Showers */\n  .weather-condition-slight-rain-showers {\n    --gradient-color-1: #4682b4;\n    --gradient-color-2: #5f9ea0;\n    --gradient-color-3: #87ceeb;\n    --card-text-color: #e6f3ff;\n  }\n  .weather-condition-moderate-rain-showers {\n    --gradient-color-1: #4682b4;\n    --gradient-color-2: #5f9ea0;\n    --gradient-color-3: #87ceeb;\n    --card-text-color: #e6f3ff;\n  }\n  .weather-condition-violent-rain-showers {\n    --gradient-color-1: #191970;\n    --gradient-color-2: #4169e1;\n    --gradient-color-3: #1e90ff;\n    --card-text-color: #e6f3ff;\n  }\n\n  /* Snow Showers */\n  .weather-condition-slight-snow-showers {\n    --gradient-color-1: #f0f8ff;\n    --gradient-color-2: #e6e6fa;\n    --gradient-color-3: #ffffff;\n    --card-text-color: #1a1a2e;\n  }\n  .weather-condition-heavy-snow-showers {\n    --gradient-color-1: #f0f8ff;\n    --gradient-color-2: #e6e6fa;\n    --gradient-color-3: #ffffff;\n    --card-text-color: #1a1a2e;\n  }\n\n  /* Thunderstorm Conditions */\n  .weather-condition-slight-thunderstorm {\n    --gradient-color-1: #2f2f2f;\n    --gradient-color-2: #4b0082;\n    --gradient-color-3: #8a2be2;\n    --card-text-color: #f0e6ff;\n  }\n  .weather-condition-thunderstorm-with-slight-hail {\n    --gradient-color-1: #483d8b;\n    --gradient-color-2: #6a5acd;\n    --gradient-color-3: #9370db;\n    --card-text-color: #f0e6ff;\n  }\n  .weather-condition-thunderstorm-with-heavy-hail {\n    --gradient-color-1: #483d8b;\n    --gradient-color-2: #6a5acd;\n    --gradient-color-3: #9370db;\n    --card-text-color: #f0e6ff;\n  } \n\n   @container weather-card (min-width: 600px) {\n    .weather-card {\n     grid-template-columns: 1fr auto;\n     grid-template-areas:\n      \"location temperature\"\n      \"condition-container temperature \"\n    }\n    .temperature {\n      justify-content: flex-end;\n      margin-bottom: 0px;\n    }\n    .temperature-value {\n      font-size: 20cqw;\n    }\n  }\n\n  \n</style>\n  \n<article class=\"mcp-ui-container\">\n  <div class=\"weather-card weather-condition-partly-cloudy\">\n    <p class=\"location\">Paris</p>\n    <p class=\"temperature\">\n      <span class=\"temperature-value\">69</span>\n      <span class=\"temperature-unit\">¬∞F</span>\n    </p>\n    <div class=\"weather-condition-container\">\n      <p class=\"condition\">Partly Cloudy</p>\n      <p class=\"wind-speed\">\n        <span class=\"wind-speed-value\">8</span>\n        <span class=\"wind-speed-unit\">mph</span>\n        <span class=\"wind-speed-label\">Winds</span>\n      </p>\n      <p class=\"humidity\">\n      <span class=\"humidity-value\">55%</span>\n      <span class=\"humidity-label\">Humidity</span>\n      </p>\n    </div>\n  </div>\n</article>\n  \n<script>\n  const mcpUiContainer = document.querySelector('.mcp-ui-container');\n  \n  function postSize() {\n    const height = mcpUiContainer.scrollHeight;\n    const width = mcpUiContainer.scrollWidth;\n    window.parent.postMessage(\n      {\n        type: \"ui-size-change\",\n        payload: {\n          height: height,\n          width: width, \n        },\n      },\n      \"*\",\n    );\n  }\n\n  // Create ResizeObserver to watch for size changes\n  const resizeObserver = new ResizeObserver((entries) => {\n    for (const entry of entries) {\n      // Post size whenever document size changes\n      postSize();\n    }\n  });\n\n  // Start observing the mcp-ui-container element\n  resizeObserver.observe(mcpUiContainer);\n</script>\n<script>\n  const link = document.createElement('link');\n  link.rel = 'preconnect';\n  link.href = 'https://rsms.me/';\n  document.head.appendChild(link);\n\n  const link2 = document.createElement('link');\n  link2.rel = 'stylesheet';\n  link2.href = 'https://rsms.me/inter/inter.css';\n  document.head.appendChild(link2);\n</script>"
            },
            "_meta": {
              "goose": {
                "displayType": "inline"
              }
            },
            "annotations": {
              "audience": [
                "user"
              ]
            }
          }
        ]
      } as t.MCPToolCallResponse;
      const provider = 'openai' as t.Provider;

      const [formattedContent, artifacts] = formatToolContent(result, provider);
      
      expect(formattedContent).toEqual([
        {
          type: 'text',
          text: 'Resource Text: {"location":"Paris","temperature":69,"unit":"¬∞F","condition":"Partly Cloudy","humidity":55,"windSpeed":8,"windUnit":"mph","description":"Current weather in Paris"}\n' +
            'Resource URI: http://mcp-aharvard/weather-data\n' +
            'Resource MIME Type: application/json'
        },
        {
          type: 'text',
          metadata: 'ui_resources',
          text: 'W3sidXJpIjoidWk6Ly9tY3AtYWhhcnZhcmQvd2VhdGhlci1jYXJkIiwibWltZVR5cGUiOiJ0ZXh0L2h0bWwiLCJ0ZXh0IjoiXG48c3R5bGU+XG4gICoge1xuICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIH1cbiAgOnJvb3Qge1xuICAgIGZvbnQtZmFtaWx5OiBJbnRlciwgc2Fucy1zZXJpZjtcbiAgICBmb250LWZlYXR1cmUtc2V0dGluZ3M6ICdsaWdhJyAxLCAnY2FsdCcgMTsgLyogZml4IGZvciBDaHJvbWUgKi9cbiAgICAtLWNhcmQtYmFja2dyb3VuZC1jb2xvcjogIzAwMDAwMDtcbiAgICAtLWNhcmQtdGV4dC1jb2xvcjogI2ZmZmZmZjtcbiAgfVxuICBAc3VwcG9ydHMgKGZvbnQtdmFyaWF0aW9uLXNldHRpbmdzOiBub3JtYWwpIHtcbiAgICA6cm9vdCB7IGZvbnQtZmFtaWx5OiBJbnRlclZhcmlhYmxlLCBzYW5zLXNlcmlmOyB9XG4gIH1cbiAgaHRtbCwgYm9keSB7XG4gICBvdmVyZmxvdzogaGlkZGVuO1xuICB9XG4gIGJvZHkge1xuICAgIG1hcmdpbjogMDtcbiAgICBwYWRkaW5nOiAwO1xuICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50O1xuICAgIGRpc3BsYXk6IGdyaWQ7XG4gIH1cbiAgLm1jcC11aS1jb250YWluZXJ7XG4gICAgLy8gbWF4LXdpZHRoOiA3MDBweDsgXG4gICAgY29udGFpbmVyLXR5cGU6IGlubGluZS1zaXplO1xuICAgIGNvbnRhaW5lci1uYW1lOiB3ZWF0aGVyLWNhcmQ7XG4gIH1cbiBcbiAgLndlYXRoZXItY2FyZCB7XG4gICAgbWFyZ2luOiAxMHB4O1xuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICBjb2xvcjogdmFyKC0tY2FyZC10ZXh0LWNvbG9yKTtcbiAgICBwYWRkaW5nOiAzMHB4IDMwcHggNDBweCAzMHB4O1xuICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICBib3gtc2hhZG93OiAwIDAgMCAxMHB4IHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KTtcbiAgICBkaXNwbGF5OiBncmlkO1xuICAgIGdhcDogOHB4O1xuICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyO1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgZ3JpZC10ZW1wbGF0ZS1hcmVhczpcbiAgICAgIFwibG9jYXRpb25cIlxuICAgICAgXCJ0ZW1wZXJhdHVyZVwiXG4gICAgICBcImNvbmRpdGlvbi1jb250YWluZXIgXCJcbiAgfVxuICAud2VhdGhlci1jYXJkICoge1xuICAgIG1hcmdpbjogMDtcbiAgICBsaW5lLWhlaWdodDogMTtcbiAgfVxuICAubG9jYXRpb24ge1xuICAgIGZvbnQtc2l6ZTogNDhweDtcbiAgICBmb250LXdlaWdodDogNzAwO1xuICAgIGdyaWQtYXJlYTogbG9jYXRpb247XG4gIH1cbiAgLnRlbXBlcmF0dXJlIHtcbiAgICBncmlkLWFyZWE6IHRlbXBlcmF0dXJlO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgYWxpZ24taXRlbXM6IHRvcDtcbiAgICBtYXJnaW4tYm90dG9tOiAxNXB4O1xuICB9XG4gIC50ZW1wZXJhdHVyZS12YWx1ZSB7XG4gICAgZm9udC13ZWlnaHQ6IDkwMDtcbiAgICBmb250LXNpemU6IDMwY3F3O1xuICAgIGxpbmUtaGVpZ2h0OiAwLjg7XG4gICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDEwcHgpO1xuICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCAycHggMXB4IHJnYmEoMTIwLCAxMjAsIDEyMCwgMC4yNSkpO1xuICB9XG4gIC50ZW1wZXJhdHVyZS11bml0IHtcbiAgICBmb250LXNpemU6IDMwcHg7XG4gICAgbWFyZ2luLXRvcDogOHB4O1xuICB9XG4gIC53ZWF0aGVyLWNvbmRpdGlvbi1jb250YWluZXJ7XG4gICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTtcbiAgICBmb250LXNpemU6IDE0cHg7XG4gICAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgICBsZXR0ZXItc3BhY2luZzogMC4wNWVtO1xuICAgIGFsaWduLXNlbGY6IGZsZXgtZW5kO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICBnYXA6IDZweDtcbiAgICBncmlkLWFyZWE6IGNvbmRpdGlvbi1jb250YWluZXI7XG4gIH1cbiAgLmNvbmRpdGlvbiB7XG4gICAgZm9udC1zaXplOiAxOHB4O1xuICAgIGZvbnQtd2VpZ2h0OiA4MDA7XG4gICAgbWFyZ2luLWJvdHRvbTogNHB4O1xuICB9XG4gIC53aW5kLXNwZWVkLFxuICAuaHVtaWRpdHkge1xuICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICBmb250LXdlaWdodDogMjUwMDtcbiAgICBsZXR0ZXItc3BhY2luZzogMC4wNWVtO1xuICAgIG9wYWNpdHk6IDAuNzU7ICBcbiAgfVxuICBcbiAgICAvKiBSb3RhdGluZyBncmFkaWVudCBhbmltYXRpb24gdXNpbmcgcHNldWRvLWVsZW1lbnQgKi9cbiAgQGtleWZyYW1lcyByb3RhdGVHcmFkaWVudCB7XG4gICAgMCUge1xuICAgICAgdHJhbnNmb3JtOiByb3RhdGUoLTYwZGVnKTtcbiAgICAgIHNjYWxlOiAxO1xuICAgIH1cbiAgICAxMDAlIHtcbiAgICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpO1xuICAgICAgc2NhbGU6IDEuNTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qIFBzZXVkby1lbGVtZW50IGZvciBhbmltYXRlZCBncmFkaWVudCBiYWNrZ3JvdW5kICovXG4gIC53ZWF0aGVyLWNhcmQ6OmJlZm9yZSB7XG4gICAgY29udGVudDogJyc7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIC0tc2l6ZTogMjAwJTtcbiAgICB0b3A6IC01MGNxdztcbiAgICBsZWZ0OiBjYWxjKDUwJSAtIHZhcigtLXNpemUpIC8gMik7XG4gICAgd2lkdGg6IHZhcigtLXNpemUpO1xuICAgIGFzcGVjdC1yYXRpbzogMS8xO1xuICAgIHRyYW5zZm9ybS1vcmlnaW46IGNlbnRlcjtcbiAgICB6LWluZGV4OiAtMTtcbiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCB2YXIoLS1ncmFkaWVudC1jb2xvci0xKSwgdmFyKC0tZ3JhZGllbnQtY29sb3ItMiksIHZhcigtLWdyYWRpZW50LWNvbG9yLTMpKTtcbiAgICBhbmltYXRpb246IHJvdGF0ZUdyYWRpZW50IDNzIGVhc2UtaW4tb3V0IGluZmluaXRlIGFsdGVybmF0ZTtcbiAgfVxuICBcbiAgLyogQ2xlYXIgYW5kIFN1bm55IENvbmRpdGlvbnMgKi9cbiAgLndlYXRoZXItY29uZGl0aW9uLWNsZWFyLXNreSB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjMWU5MGZmO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogIzAwYmZmZjtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICM4N2NlZWI7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICNlNmYzZmY7XG4gIH1cbiAgLndlYXRoZXItY29uZGl0aW9uLW1haW5seS1jbGVhciB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjODdjZWViO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogI2IwZTBlNjtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICNmMGY4ZmY7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICMxYTNjNGE7XG4gIH1cbiAgLndlYXRoZXItY29uZGl0aW9uLXBhcnRseS1jbG91ZHkge1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMTogIzg3Y2VlYjtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTI6ICNiMGUwZTY7XG4gICAgLS1ncmFkaWVudC1jb2xvci0zOiAjZjBmOGZmO1xuICAgIC0tY2FyZC10ZXh0LWNvbG9yOiAjMWEzYzRhO1xuICB9XG4gIC53ZWF0aGVyLWNvbmRpdGlvbi1vdmVyY2FzdCB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjNzA4MDkwO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogIzc3ODg5OTtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICNiMGM0ZGU7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICNlOGYwZjg7XG4gIH1cblxuICAvKiBGb2cgQ29uZGl0aW9ucyAqL1xuICAud2VhdGhlci1jb25kaXRpb24tZm9nIHtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTE6ICNkM2QzZDM7XG4gICAgLS1ncmFkaWVudC1jb2xvci0yOiAjZTZlNmU2O1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMzogI2Y1ZjVmNTtcbiAgICAtLWNhcmQtdGV4dC1jb2xvcjogIzJkMmQyZDtcbiAgfVxuICAud2VhdGhlci1jb25kaXRpb24tZGVwb3NpdGluZy1yaW1lLWZvZyB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjZDNkM2QzO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogI2U2ZTZlNjtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICNmNWY1ZjU7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICMyZDJkMmQ7XG4gIH1cblxuICAvKiBEcml6emxlIENvbmRpdGlvbnMgKi9cbiAgLndlYXRoZXItY29uZGl0aW9uLWxpZ2h0LWRyaXp6bGUge1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMTogIzVmOWVhMDtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTI6ICM3ZmIzZDM7XG4gICAgLS1ncmFkaWVudC1jb2xvci0zOiAjYjBlMGU2O1xuICAgIC0tY2FyZC10ZXh0LWNvbG9yOiAjZTZmN2ZmO1xuICB9XG4gIC53ZWF0aGVyLWNvbmRpdGlvbi1tb2RlcmF0ZS1kcml6emxlIHtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTE6ICM1ZjllYTA7XG4gICAgLS1ncmFkaWVudC1jb2xvci0yOiAjN2ZiM2QzO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMzogI2IwZTBlNjtcbiAgICAtLWNhcmQtdGV4dC1jb2xvcjogI2U2ZjdmZjtcbiAgfVxuICAud2VhdGhlci1jb25kaXRpb24tZGVuc2UtZHJpenpsZSB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjNWY5ZWEwO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogIzdmYjNkMztcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICNiMGUwZTY7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICNlNmY3ZmY7XG4gIH1cbiAgLndlYXRoZXItY29uZGl0aW9uLWxpZ2h0LWZyZWV6aW5nLWRyaXp6bGUge1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMTogIzQ2ODJiNDtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTI6ICM1ZjllYTA7XG4gICAgLS1ncmFkaWVudC1jb2xvci0zOiAjYjBjNGRlO1xuICAgIC0tY2FyZC10ZXh0LWNvbG9yOiAjZTZmM2ZmO1xuICB9XG4gIC53ZWF0aGVyLWNvbmRpdGlvbi1kZW5zZS1mcmVlemluZy1kcml6emxlIHtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTE6ICM0NjgyYjQ7XG4gICAgLS1ncmFkaWVudC1jb2xvci0yOiAjNWY5ZWEwO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMzogI2IwYzRkZTtcbiAgICAtLWNhcmQtdGV4dC1jb2xvcjogI2U2ZjNmZjtcbiAgfVxuXG4gIC8qIFJhaW4gQ29uZGl0aW9ucyAqL1xuICAud2VhdGhlci1jb25kaXRpb24tc2xpZ2h0LXJhaW4ge1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMTogIzQ2ODJiNDtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTI6ICM1ZjllYTA7XG4gICAgLS1ncmFkaWVudC1jb2xvci0zOiAjODdjZWViO1xuICAgIC0tY2FyZC10ZXh0LWNvbG9yOiAjZTZmM2ZmO1xuICB9XG4gIC53ZWF0aGVyLWNvbmRpdGlvbi1tb2RlcmF0ZS1yYWluIHtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTE6ICM0NjgyYjQ7XG4gICAgLS1ncmFkaWVudC1jb2xvci0yOiAjNWY5ZWEwO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMzogIzg3Y2VlYjtcbiAgICAtLWNhcmQtdGV4dC1jb2xvcjogI2U2ZjNmZjtcbiAgfVxuICAud2VhdGhlci1jb25kaXRpb24taGVhdnktcmFpbiB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjMTkxOTcwO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogIzQxNjllMTtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICMxZTkwZmY7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICNlNmYzZmY7XG4gIH1cbiAgLndlYXRoZXItY29uZGl0aW9uLWxpZ2h0LWZyZWV6aW5nLXJhaW4ge1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMTogIzQ2ODJiNDtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTI6ICM1ZjllYTA7XG4gICAgLS1ncmFkaWVudC1jb2xvci0zOiAjYjBjNGRlO1xuICAgIC0tY2FyZC10ZXh0LWNvbG9yOiAjZTZmM2ZmO1xuICB9XG4gIC53ZWF0aGVyLWNvbmRpdGlvbi1oZWF2eS1mcmVlemluZy1yYWluIHtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTE6ICM0NjgyYjQ7XG4gICAgLS1ncmFkaWVudC1jb2xvci0yOiAjNWY5ZWEwO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMzogI2IwYzRkZTtcbiAgICAtLWNhcmQtdGV4dC1jb2xvcjogI2U2ZjNmZjtcbiAgfVxuXG4gIC8qIFNub3cgQ29uZGl0aW9ucyAqL1xuICAud2VhdGhlci1jb25kaXRpb24tc2xpZ2h0LXNub3cge1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMTogI2YwZjhmZjtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTI6ICNlNmU2ZmE7XG4gICAgLS1ncmFkaWVudC1jb2xvci0zOiAjZmZmZmZmO1xuICAgIC0tY2FyZC10ZXh0LWNvbG9yOiAjMWExYTJlO1xuICB9XG4gIC53ZWF0aGVyLWNvbmRpdGlvbi1tb2RlcmF0ZS1zbm93IHtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTE6ICNmMGY4ZmY7XG4gICAgLS1ncmFkaWVudC1jb2xvci0yOiAjZTZlNmZhO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMzogI2ZmZmZmZjtcbiAgICAtLWNhcmQtdGV4dC1jb2xvcjogIzFhMWEyZTtcbiAgfVxuICAud2VhdGhlci1jb25kaXRpb24taGVhdnktc25vdyB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjZjBmOGZmO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogI2U2ZTZmYTtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICNmZmZmZmY7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICMxYTFhMmU7XG4gIH1cbiAgLndlYXRoZXItY29uZGl0aW9uLXNub3ctZ3JhaW5zIHtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTE6ICNmMGY4ZmY7XG4gICAgLS1ncmFkaWVudC1jb2xvci0yOiAjZTZlNmZhO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMzogI2ZmZmZmZjtcbiAgICAtLWNhcmQtdGV4dC1jb2xvcjogIzFhMWEyZTtcbiAgfVxuXG4gIC8qIFJhaW4gU2hvd2VycyAqL1xuICAud2VhdGhlci1jb25kaXRpb24tc2xpZ2h0LXJhaW4tc2hvd2VycyB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjNDY4MmI0O1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogIzVmOWVhMDtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICM4N2NlZWI7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICNlNmYzZmY7XG4gIH1cbiAgLndlYXRoZXItY29uZGl0aW9uLW1vZGVyYXRlLXJhaW4tc2hvd2VycyB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjNDY4MmI0O1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogIzVmOWVhMDtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICM4N2NlZWI7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICNlNmYzZmY7XG4gIH1cbiAgLndlYXRoZXItY29uZGl0aW9uLXZpb2xlbnQtcmFpbi1zaG93ZXJzIHtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTE6ICMxOTE5NzA7XG4gICAgLS1ncmFkaWVudC1jb2xvci0yOiAjNDE2OWUxO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMzogIzFlOTBmZjtcbiAgICAtLWNhcmQtdGV4dC1jb2xvcjogI2U2ZjNmZjtcbiAgfVxuXG4gIC8qIFNub3cgU2hvd2VycyAqL1xuICAud2VhdGhlci1jb25kaXRpb24tc2xpZ2h0LXNub3ctc2hvd2VycyB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjZjBmOGZmO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogI2U2ZTZmYTtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICNmZmZmZmY7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICMxYTFhMmU7XG4gIH1cbiAgLndlYXRoZXItY29uZGl0aW9uLWhlYXZ5LXNub3ctc2hvd2VycyB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjZjBmOGZmO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogI2U2ZTZmYTtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICNmZmZmZmY7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICMxYTFhMmU7XG4gIH1cblxuICAvKiBUaHVuZGVyc3Rvcm0gQ29uZGl0aW9ucyAqL1xuICAud2VhdGhlci1jb25kaXRpb24tc2xpZ2h0LXRodW5kZXJzdG9ybSB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjMmYyZjJmO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogIzRiMDA4MjtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICM4YTJiZTI7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICNmMGU2ZmY7XG4gIH1cbiAgLndlYXRoZXItY29uZGl0aW9uLXRodW5kZXJzdG9ybS13aXRoLXNsaWdodC1oYWlsIHtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTE6ICM0ODNkOGI7XG4gICAgLS1ncmFkaWVudC1jb2xvci0yOiAjNmE1YWNkO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMzogIzkzNzBkYjtcbiAgICAtLWNhcmQtdGV4dC1jb2xvcjogI2YwZTZmZjtcbiAgfVxuICAud2VhdGhlci1jb25kaXRpb24tdGh1bmRlcnN0b3JtLXdpdGgtaGVhdnktaGFpbCB7XG4gICAgLS1ncmFkaWVudC1jb2xvci0xOiAjNDgzZDhiO1xuICAgIC0tZ3JhZGllbnQtY29sb3ItMjogIzZhNWFjZDtcbiAgICAtLWdyYWRpZW50LWNvbG9yLTM6ICM5MzcwZGI7XG4gICAgLS1jYXJkLXRleHQtY29sb3I6ICNmMGU2ZmY7XG4gIH0gXG5cbiAgIEBjb250YWluZXIgd2VhdGhlci1jYXJkIChtaW4td2lkdGg6IDYwMHB4KSB7XG4gICAgLndlYXRoZXItY2FyZCB7XG4gICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIGF1dG87XG4gICAgIGdyaWQtdGVtcGxhdGUtYXJlYXM6XG4gICAgICBcImxvY2F0aW9uIHRlbXBlcmF0dXJlXCJcbiAgICAgIFwiY29uZGl0aW9uLWNvbnRhaW5lciB0ZW1wZXJhdHVyZSBcIlxuICAgIH1cbiAgICAudGVtcGVyYXR1cmUge1xuICAgICAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDtcbiAgICAgIG1hcmdpbi1ib3R0b206IDBweDtcbiAgICB9XG4gICAgLnRlbXBlcmF0dXJlLXZhbHVlIHtcbiAgICAgIGZvbnQtc2l6ZTogMjBjcXc7XG4gICAgfVxuICB9XG5cbiAgXG48L3N0eWxlPlxuICBcbjxhcnRpY2xlIGNsYXNzPVwibWNwLXVpLWNvbnRhaW5lclwiPlxuICA8ZGl2IGNsYXNzPVwid2VhdGhlci1jYXJkIHdlYXRoZXItY29uZGl0aW9uLXBhcnRseS1jbG91ZHlcIj5cbiAgICA8cCBjbGFzcz1cImxvY2F0aW9uXCI+UGFyaXM8L3A+XG4gICAgPHAgY2xhc3M9XCJ0ZW1wZXJhdHVyZVwiPlxuICAgICAgPHNwYW4gY2xhc3M9XCJ0ZW1wZXJhdHVyZS12YWx1ZVwiPjY5PC9zcGFuPlxuICAgICAgPHNwYW4gY2xhc3M9XCJ0ZW1wZXJhdHVyZS11bml0XCI+wrBGPC9zcGFuPlxuICAgIDwvcD5cbiAgICA8ZGl2IGNsYXNzPVwid2VhdGhlci1jb25kaXRpb24tY29udGFpbmVyXCI+XG4gICAgICA8cCBjbGFzcz1cImNvbmRpdGlvblwiPlBhcnRseSBDbG91ZHk8L3A+XG4gICAgICA8cCBjbGFzcz1cIndpbmQtc3BlZWRcIj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJ3aW5kLXNwZWVkLXZhbHVlXCI+ODwvc3Bhbj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJ3aW5kLXNwZWVkLXVuaXRcIj5tcGg8L3NwYW4+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwid2luZC1zcGVlZC1sYWJlbFwiPldpbmRzPC9zcGFuPlxuICAgICAgPC9wPlxuICAgICAgPHAgY2xhc3M9XCJodW1pZGl0eVwiPlxuICAgICAgPHNwYW4gY2xhc3M9XCJodW1pZGl0eS12YWx1ZVwiPjU1JTwvc3Bhbj5cbiAgICAgIDxzcGFuIGNsYXNzPVwiaHVtaWRpdHktbGFiZWxcIj5IdW1pZGl0eTwvc3Bhbj5cbiAgICAgIDwvcD5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2FydGljbGU+XG4gIFxuPHNjcmlwdD5cbiAgY29uc3QgbWNwVWlDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWNwLXVpLWNvbnRhaW5lcicpO1xuICBcbiAgZnVuY3Rpb24gcG9zdFNpemUoKSB7XG4gICAgY29uc3QgaGVpZ2h0ID0gbWNwVWlDb250YWluZXIuc2Nyb2xsSGVpZ2h0O1xuICAgIGNvbnN0IHdpZHRoID0gbWNwVWlDb250YWluZXIuc2Nyb2xsV2lkdGg7XG4gICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZShcbiAgICAgIHtcbiAgICAgICAgdHlwZTogXCJ1aS1zaXplLWNoYW5nZVwiLFxuICAgICAgICBwYXlsb2FkOiB7XG4gICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgd2lkdGg6IHdpZHRoLCBcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBcIipcIixcbiAgICApO1xuICB9XG5cbiAgLy8gQ3JlYXRlIFJlc2l6ZU9ic2VydmVyIHRvIHdhdGNoIGZvciBzaXplIGNoYW5nZXNcbiAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKGVudHJpZXMpID0+IHtcbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgIC8vIFBvc3Qgc2l6ZSB3aGVuZXZlciBkb2N1bWVudCBzaXplIGNoYW5nZXNcbiAgICAgIHBvc3RTaXplKCk7XG4gICAgfVxuICB9KTtcblxuICAvLyBTdGFydCBvYnNlcnZpbmcgdGhlIG1jcC11aS1jb250YWluZXIgZWxlbWVudFxuICByZXNpemVPYnNlcnZlci5vYnNlcnZlKG1jcFVpQ29udGFpbmVyKTtcbjwvc2NyaXB0PlxuPHNjcmlwdD5cbiAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTtcbiAgbGluay5yZWwgPSAncHJlY29ubmVjdCc7XG4gIGxpbmsuaHJlZiA9ICdodHRwczovL3JzbXMubWUvJztcbiAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChsaW5rKTtcblxuICBjb25zdCBsaW5rMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTtcbiAgbGluazIucmVsID0gJ3N0eWxlc2hlZXQnO1xuICBsaW5rMi5ocmVmID0gJ2h0dHBzOi8vcnNtcy5tZS9pbnRlci9pbnRlci5jc3MnO1xuICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGxpbmsyKTtcbjwvc2NyaXB0PiJ9XQ=='
        }
      ]);
      expect(artifacts).toEqual(undefined);
    });

    it('should properly encode a resource with many emojis in the HTML to render', () => {
      const result = {
        "content": [
          {
            "type": "resource",
            "resource": {
              "uri": "ui://mcp-aharvard/mood-trip-planner",
              "mimeType": "text/html",
              "text": "\n<style>\n  * {\n    box-sizing: border-box;\n  }\n  :root {\n    font-family: Inter, sans-serif;\n    font-feature-settings: 'liga' 1, 'calt' 1;\n    --primary-color: #3b82f6;\n    --secondary-color: #10b981;\n    --accent-color: #f59e0b;\n    --text-color: #1f2937;\n    --light-bg: #f8fafc;\n  }\n  @supports (font-variation-settings: normal) {\n    :root { font-family: InterVariable, sans-serif; }\n  }\n  html, body {\n    overflow: hidden;\n    margin: 0;\n    padding: 0;\n  }\n  body {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n  }\n  \n  .mcp-ui-container {\n    min-height: 500px;\n    position: relative;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 20px;\n  }\n  \n  .trip-planner-card {\n    background: white;\n    border-radius: 20px;\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);\n    padding: 40px;\n    max-width: 600px;\n    width: 100%;\n    text-align: center;\n    position: relative;\n    overflow: hidden;\n  }\n  \n  .trip-planner-card::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 4px;\n    background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);\n    background-size: 400% 400%;\n    animation: gradientShift 3s ease infinite;\n  }\n  \n  @keyframes gradientShift {\n    0%, 100% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n  }\n  \n  .header {\n    margin-bottom: 30px;\n  }\n  \n  .header h1 {\n    font-size: 32px;\n    font-weight: 700;\n    color: var(--text-color);\n    margin: 0 0 10px 0;\n    background: linear-gradient(135deg, #667eea, #764ba2);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n  }\n  \n  .header p {\n    font-size: 16px;\n    color: #6b7280;\n    margin: 0;\n  }\n  \n  .mood-grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 20px;\n    margin-bottom: 30px;\n  }\n  \n  .mood-button {\n    background: white;\n    border: 3px solid #e5e7eb;\n    border-radius: 16px;\n    padding: 24px 16px;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    position: relative;\n    overflow: hidden;\n  }\n  \n  .mood-button:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);\n    border-color: var(--primary-color);\n  }\n  \n  .mood-button.selected {\n    border-color: var(--secondary-color);\n    background: linear-gradient(135deg, #ecfdf5, #d1fae5);\n    transform: translateY(-4px) scale(1.05);\n    box-shadow: 0 16px 32px rgba(16, 185, 129, 0.3);\n  }\n  \n  .mood-button::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: -100%;\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);\n    transition: left 0.5s;\n  }\n  \n  .mood-button:hover::before {\n    left: 100%;\n  }\n  \n  .mood-emoji {\n    font-size: 48px;\n    margin-bottom: 12px;\n    display: block;\n    filter: grayscale(0.3);\n    transition: all 0.3s ease;\n  }\n  \n  .mood-button:hover .mood-emoji,\n  .mood-button.selected .mood-emoji {\n    filter: grayscale(0);\n    transform: scale(1.1);\n  }\n  \n  .mood-label {\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--text-color);\n    margin: 0;\n    text-transform: capitalize;\n  }\n  \n  .mood-description {\n    font-size: 12px;\n    color: #6b7280;\n    margin: 4px 0 0 0;\n    opacity: 0.8;\n  }\n  \n  .action-buttons {\n    display: flex;\n    gap: 12px;\n    justify-content: center;\n    margin-top: 20px;\n  }\n  \n  .btn {\n    padding: 12px 24px;\n    border: none;\n    border-radius: 8px;\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    position: relative;\n    overflow: hidden;\n  }\n  \n  .btn-primary {\n    background: linear-gradient(135deg, var(--primary-color), #2563eb);\n    color: white;\n  }\n  \n  .btn-primary:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);\n  }\n  \n  .btn-secondary {\n    background: #f3f4f6;\n    color: var(--text-color);\n    border: 2px solid #e5e7eb;\n  }\n  \n  .btn-secondary:hover:not(:disabled) {\n    background: #e5e7eb;\n    transform: translateY(-1px);\n  }\n  \n  .btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none !important;\n  }\n  \n  .destination-reveal {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    opacity: 0;\n    transform: scale(0.8);\n    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10;\n    border-radius: 20px;\n    pointer-events: none;\n  }\n  \n  .destination-reveal.show {\n    opacity: 1;\n    transform: scale(1);\n    pointer-events: auto;\n  }\n  \n  .destination-content {\n    text-align: center;\n    color: white;\n    max-width: 400px;\n    padding: 20px;\n  }\n  \n  .destination-emoji {\n    font-size: 64px;\n    margin-bottom: 20px;\n    display: block;\n    animation: bounce 1s ease-in-out;\n  }\n  \n  @keyframes bounce {\n    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }\n    40% { transform: translateY(-20px); }\n    60% { transform: translateY(-10px); }\n  }\n  \n  .destination-title {\n    font-size: 32px;\n    font-weight: 700;\n    margin: 0 0 16px 0;\n    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n  }\n  \n  .destination-subtitle {\n    font-size: 18px;\n    margin: 0 0 24px 0;\n    opacity: 0.9;\n  }\n  \n  .destination-details {\n    background: rgba(255, 255, 255, 0.1);\n    backdrop-filter: blur(10px);\n    border-radius: 12px;\n    padding: 20px;\n    margin-bottom: 24px;\n  }\n  \n  .destination-location {\n    font-size: 24px;\n    font-weight: 600;\n    margin: 0 0 12px 0;\n    color: #fbbf24;\n  }\n  \n  .destination-activities {\n    font-size: 14px;\n    opacity: 0.9;\n    line-height: 1.5;\n  }\n  \n  .new-trip-btn {\n    background: rgba(255, 255, 255, 0.2);\n    color: white;\n    border: 2px solid rgba(255, 255, 255, 0.3);\n    backdrop-filter: blur(10px);\n  }\n  \n  .new-trip-btn:hover {\n    background: rgba(255, 255, 255, 0.3);\n    border-color: rgba(255, 255, 255, 0.5);\n    transform: translateY(-2px);\n  }\n  \n  .sparkles {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    pointer-events: none;\n    overflow: hidden;\n  }\n  \n  .sparkle {\n    position: absolute;\n    width: 4px;\n    height: 4px;\n    background: white;\n    border-radius: 50%;\n    animation: sparkle 2s linear infinite;\n  }\n  \n  @keyframes sparkle {\n    0% { opacity: 0; transform: scale(0) rotate(0deg); }\n    50% { opacity: 1; transform: scale(1) rotate(180deg); }\n    100% { opacity: 0; transform: scale(0) rotate(360deg); }\n  }\n  \n  .loading-animation {\n    display: none;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    z-index: 5;\n  }\n  \n  .loading-spinner {\n    width: 40px;\n    height: 40px;\n    border: 4px solid rgba(255, 255, 255, 0.3);\n    border-top: 4px solid white;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n  }\n  \n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n  \n  @media (max-width: 640px) {\n    .mood-grid {\n      grid-template-columns: repeat(2, 1fr);\n      gap: 16px;\n    }\n    \n    .mood-button {\n      padding: 20px 12px;\n    }\n    \n    .mood-emoji {\n      font-size: 40px;\n    }\n    \n    .trip-planner-card {\n      padding: 24px;\n      margin: 10px;\n    }\n    \n    .header h1 {\n      font-size: 24px;\n    }\n  }\n</style>\n\n<script>\n  const link = document.createElement('link');\n  link.rel = 'preconnect';\n  link.href = 'https://rsms.me/';\n  document.head.appendChild(link);\n\n  const link2 = document.createElement('link');\n  link2.rel = 'stylesheet';\n  link2.href = 'https://rsms.me/inter/inter.css';\n  document.head.appendChild(link2);\n</script>\n<article class=\"mcp-ui-container\">\n  <div class=\"trip-planner-card\">\n    <div class=\"header\">\n      <h1>‚úàÔ∏è Plan Your Perfect Trip</h1>\n      <p>Tell us how you're feeling, and we'll suggest the perfect destination!</p>\n    </div>\n    \n    <div class=\"mood-selection\">\n      <div class=\"mood-grid\">\n        <div class=\"mood-button\" data-mood=\"adventurous\">\n          <span class=\"mood-emoji\">üèîÔ∏è</span>\n          <p class=\"mood-label\">Adventurous</p>\n          <p class=\"mood-description\">Seeking thrills & excitement</p>\n        </div>\n        \n        <div class=\"mood-button\" data-mood=\"relaxed\">\n          <span class=\"mood-emoji\">üèñÔ∏è</span>\n          <p class=\"mood-label\">Relaxed</p>\n          <p class=\"mood-description\">Need peace & tranquility</p>\n        </div>\n        \n        <div class=\"mood-button\" data-mood=\"cultural\">\n          <span class=\"mood-emoji\">üèõÔ∏è</span>\n          <p class=\"mood-label\">Cultural</p>\n          <p class=\"mood-description\">Explore history & traditions</p>\n        </div>\n        \n        <div class=\"mood-button\" data-mood=\"romantic\">\n          <span class=\"mood-emoji\">üíï</span>\n          <p class=\"mood-label\">Romantic</p>\n          <p class=\"mood-description\">Love is in the air</p>\n        </div>\n        \n        <div class=\"mood-button\" data-mood=\"foodie\">\n          <span class=\"mood-emoji\">üçú</span>\n          <p class=\"mood-label\">Foodie</p>\n          <p class=\"mood-description\">Culinary adventures await</p>\n        </div>\n        \n        <div class=\"mood-button\" data-mood=\"party\">\n          <span class=\"mood-emoji\">üéâ</span>\n          <p class=\"mood-label\">Party</p>\n          <p class=\"mood-description\">Ready to celebrate life</p>\n        </div>\n      </div>\n      \n      <div class=\"action-buttons\">\n        <button id=\"clear-mood\" class=\"btn btn-secondary\" disabled onclick=\"clearMood()\">\n          Clear Selection\n        </button>\n        <button id=\"plan-trip\" class=\"btn btn-primary\" disabled onclick=\"planTrip()\">\n          Plan My Trip! ‚ú®\n        </button>\n      </div>\n    </div>\n    \n    <div class=\"loading-animation\" id=\"loading\">\n      <div class=\"loading-spinner\"></div>\n    </div>\n    \n    <div class=\"destination-reveal\" id=\"destination-reveal\">\n      <div class=\"sparkles\" id=\"sparkles\"></div>\n      <div class=\"destination-content\">\n        <span class=\"destination-emoji\" id=\"destination-emoji\">üåü</span>\n        <h2 class=\"destination-title\">Your Perfect Destination</h2>\n        <p class=\"destination-subtitle\" id=\"destination-subtitle\">Based on your mood...</p>\n        \n        <div class=\"destination-details\">\n          <p class=\"destination-location\" id=\"destination-location\">Loading...</p>\n          <p class=\"destination-activities\" id=\"destination-activities\">Discovering amazing activities...</p>\n        </div>\n        \n        <button class=\"btn new-trip-btn\" onclick=\"startOver()\">\n          Plan Another Trip üó∫Ô∏è\n        </button>\n      </div>\n    </div>\n  </div>\n</article>\n\n<script>\n  const mcpUiContainer = document.querySelector('.mcp-ui-container');\n  \n  function postSize() {\n    const height = mcpUiContainer.scrollHeight;\n    const width = mcpUiContainer.scrollWidth;\n    window.parent.postMessage(\n      {\n        type: \"ui-size-change\",\n        payload: {\n          height: height,\n          width: width, \n        },\n      },\n      \"*\",\n    );\n  }\n\n  // Create ResizeObserver to watch for size changes\n  const resizeObserver = new ResizeObserver((entries) => {\n    for (const entry of entries) {\n      // Post size whenever document size changes\n      postSize();\n    }\n  });\n\n  // Start observing the mcp-ui-container element\n  resizeObserver.observe(mcpUiContainer);\n</script>\n<script>\n  let selectedMood = null;\n  const moodDestinations = {\"adventurous\":{\"destinations\":[\"New Zealand\",\"Costa Rica\",\"Iceland\",\"Nepal\",\"Patagonia\"],\"activities\":[\"Bungee jumping\",\"Volcano hiking\",\"Glacier walking\",\"Mountain climbing\",\"Wildlife safari\"]},\"relaxed\":{\"destinations\":[\"Maldives\",\"Bali\",\"Santorini\",\"Tuscany\",\"Fiji\"],\"activities\":[\"Beach lounging\",\"Spa treatments\",\"Wine tasting\",\"Sunset watching\",\"Meditation retreats\"]},\"cultural\":{\"destinations\":[\"Japan\",\"Morocco\",\"India\",\"Peru\",\"Egypt\"],\"activities\":[\"Temple visits\",\"Local cooking classes\",\"Art galleries\",\"Historical tours\",\"Traditional festivals\"]},\"romantic\":{\"destinations\":[\"Paris\",\"Venice\",\"Kyoto\",\"Prague\",\"Santorini\"],\"activities\":[\"Candlelit dinners\",\"Sunset cruises\",\"Couples spa\",\"Wine tours\",\"Historic walks\"]},\"foodie\":{\"destinations\":[\"Italy\",\"Thailand\",\"Mexico\",\"France\",\"Vietnam\"],\"activities\":[\"Street food tours\",\"Cooking classes\",\"Wine tastings\",\"Market visits\",\"Michelin dining\"]},\"party\":{\"destinations\":[\"Ibiza\",\"Las Vegas\",\"Rio de Janeiro\",\"Bangkok\",\"Berlin\"],\"activities\":[\"Beach clubs\",\"Rooftop bars\",\"Music festivals\",\"Night markets\",\"Dance clubs\"]}};\n  \n  const moodEmojis = {\n    adventurous: 'üèîÔ∏è',\n    relaxed: 'üèñÔ∏è', \n    cultural: 'üèõÔ∏è',\n    romantic: 'üíï',\n    foodie: 'üçú',\n    party: 'üéâ'\n  };\n\n  function selectMood(mood) {\n    selectedMood = mood;\n    \n    // Update UI\n    document.querySelectorAll('.mood-button').forEach(button => {\n      button.classList.remove('selected');\n    });\n    document.querySelector('[data-mood=\"' + mood + '\"]').classList.add('selected');\n    \n    // Enable buttons\n    document.getElementById('clear-mood').disabled = false;\n    document.getElementById('plan-trip').disabled = false;\n  }\n\n  function clearMood() {\n    selectedMood = null;\n    \n    // Update UI\n    document.querySelectorAll('.mood-button').forEach(button => {\n      button.classList.remove('selected');\n    });\n    \n    // Disable buttons\n    document.getElementById('clear-mood').disabled = true;\n    document.getElementById('plan-trip').disabled = true;\n  }\n\n  function planTrip() {\n    if (!selectedMood) return;\n    \n    // Show loading animation\n    const loading = document.getElementById('loading');\n    loading.style.display = 'block';\n    \n    // Hide mood selection temporarily\n    document.querySelector('.mood-selection').style.opacity = '0.3';\n    document.querySelector('.mood-selection').style.pointerEvents = 'none';\n    \n    setTimeout(() => {\n      // Hide loading\n      loading.style.display = 'none';\n      \n      // Get random destination and activities for the mood\n      const moodData = moodDestinations[selectedMood];\n      const randomDestination = moodData.destinations[Math.floor(Math.random() * moodData.destinations.length)];\n      const randomActivities = moodData.activities.slice(0, 3).join(', ');\n      \n      // Update destination reveal content\n      document.getElementById('destination-emoji').textContent = moodEmojis[selectedMood];\n      document.getElementById('destination-subtitle').textContent = 'Perfect for your ' + selectedMood + ' mood!';\n      document.getElementById('destination-location').textContent = randomDestination;\n      document.getElementById('destination-activities').textContent = 'Enjoy: ' + randomActivities;\n      \n      // Create sparkles\n      createSparkles();\n      \n      // Show destination reveal with animation\n      const reveal = document.getElementById('destination-reveal');\n      reveal.classList.add('show');\n      \n      // Send message to parent\n      setTimeout(() => {\n        window.parent.postMessage({\n          type: 'tool',\n          payload: {\n            toolName: 'mood-trip-planner',\n            params: {\n              mood: selectedMood,\n              destination: randomDestination,\n              activities: moodData.activities.slice(0, 3),\n              confirmed: true\n            }\n          }\n        }, '*');\n      }, 1000);\n      \n    }, 2000);\n  }\n\n  function startOver() {\n    // Hide destination reveal\n    const reveal = document.getElementById('destination-reveal');\n    reveal.classList.remove('show');\n    \n    // Reset mood selection\n    setTimeout(() => {\n      clearMood();\n      document.querySelector('.mood-selection').style.opacity = '1';\n      document.querySelector('.mood-selection').style.pointerEvents = 'auto';\n      \n      // Clear sparkles\n      document.getElementById('sparkles').innerHTML = '';\n    }, 600);\n  }\n\n  function createSparkles() {\n    const sparklesContainer = document.getElementById('sparkles');\n    sparklesContainer.innerHTML = '';\n    \n    for (let i = 0; i < 20; i++) {\n      const sparkle = document.createElement('div');\n      sparkle.className = 'sparkle';\n      sparkle.style.left = Math.random() * 100 + '%';\n      sparkle.style.top = Math.random() * 100 + '%';\n      sparkle.style.animationDelay = Math.random() * 2 + 's';\n      sparklesContainer.appendChild(sparkle);\n    }\n  }\n\n  // Add event listeners when DOM is ready\n  document.addEventListener('DOMContentLoaded', function() {\n    // Add click listeners to mood buttons\n    document.querySelectorAll('.mood-button').forEach(button => {\n      button.addEventListener('click', function() {\n        const mood = this.getAttribute('data-mood');\n        selectMood(mood);\n      });\n    });\n\n    // Add click listeners to action buttons\n    document.getElementById('clear-mood').addEventListener('click', clearMood);\n    document.getElementById('plan-trip').addEventListener('click', planTrip);\n    document.querySelector('.new-trip-btn').addEventListener('click', startOver);\n  });\n</script>"
            },
            "annotations": {
              "audience": [
                "user"
              ]
            }
          },
          {
            "type": "text",
            "text": "Mood-based trip planner loaded! Select how you're feeling using the emoji buttons above, and I'll suggest the perfect destination with a beautiful animation reveal.",
            "annotations": {
              "audience": [
                "assistant"
              ]
            }
          }
        ]
      } as t.MCPToolCallResponse;
      const provider = 'openai' as t.Provider;

      const [formattedContent, artifacts] = formatToolContent(result, provider);
      
      expect(formattedContent).toEqual([
        {
          type: 'text',
          text: "Mood-based trip planner loaded! Select how you're feeling using the emoji buttons above, and I'll suggest the perfect destination with a beautiful animation reveal."
        },
        {
          type: 'text',
          metadata: 'ui_resources',
          text: 'W3sidXJpIjoidWk6Ly9tY3AtYWhhcnZhcmQvbW9vZC10cmlwLXBsYW5uZXIiLCJtaW1lVHlwZSI6InRleHQvaHRtbCIsInRleHQiOiJcbjxzdHlsZT5cbiAgKiB7XG4gICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgfVxuICA6cm9vdCB7XG4gICAgZm9udC1mYW1pbHk6IEludGVyLCBzYW5zLXNlcmlmO1xuICAgIGZvbnQtZmVhdHVyZS1zZXR0aW5nczogJ2xpZ2EnIDEsICdjYWx0JyAxO1xuICAgIC0tcHJpbWFyeS1jb2xvcjogIzNiODJmNjtcbiAgICAtLXNlY29uZGFyeS1jb2xvcjogIzEwYjk4MTtcbiAgICAtLWFjY2VudC1jb2xvcjogI2Y1OWUwYjtcbiAgICAtLXRleHQtY29sb3I6ICMxZjI5Mzc7XG4gICAgLS1saWdodC1iZzogI2Y4ZmFmYztcbiAgfVxuICBAc3VwcG9ydHMgKGZvbnQtdmFyaWF0aW9uLXNldHRpbmdzOiBub3JtYWwpIHtcbiAgICA6cm9vdCB7IGZvbnQtZmFtaWx5OiBJbnRlclZhcmlhYmxlLCBzYW5zLXNlcmlmOyB9XG4gIH1cbiAgaHRtbCwgYm9keSB7XG4gICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgICBtYXJnaW46IDA7XG4gICAgcGFkZGluZzogMDtcbiAgfVxuICBib2R5IHtcbiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjNjY3ZWVhIDAlLCAjNzY0YmEyIDEwMCUpO1xuICAgIG1pbi1oZWlnaHQ6IDEwMHZoO1xuICB9XG4gIFxuICAubWNwLXVpLWNvbnRhaW5lciB7XG4gICAgbWluLWhlaWdodDogNTAwcHg7XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICBwYWRkaW5nOiAyMHB4O1xuICB9XG4gIFxuICAudHJpcC1wbGFubmVyLWNhcmQge1xuICAgIGJhY2tncm91bmQ6IHdoaXRlO1xuICAgIGJvcmRlci1yYWRpdXM6IDIwcHg7XG4gICAgYm94LXNoYWRvdzogMCAyMHB4IDQwcHggcmdiYSgwLCAwLCAwLCAwLjEpO1xuICAgIHBhZGRpbmc6IDQwcHg7XG4gICAgbWF4LXdpZHRoOiA2MDBweDtcbiAgICB3aWR0aDogMTAwJTtcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG4gIH1cbiAgXG4gIC50cmlwLXBsYW5uZXItY2FyZDo6YmVmb3JlIHtcbiAgICBjb250ZW50OiAnJztcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgdG9wOiAwO1xuICAgIGxlZnQ6IDA7XG4gICAgcmlnaHQ6IDA7XG4gICAgaGVpZ2h0OiA0cHg7XG4gICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjNjY3ZWVhLCAjNzY0YmEyLCAjZjA5M2ZiLCAjZjU1NzZjKTtcbiAgICBiYWNrZ3JvdW5kLXNpemU6IDQwMCUgNDAwJTtcbiAgICBhbmltYXRpb246IGdyYWRpZW50U2hpZnQgM3MgZWFzZSBpbmZpbml0ZTtcbiAgfVxuICBcbiAgQGtleWZyYW1lcyBncmFkaWVudFNoaWZ0IHtcbiAgICAwJSwgMTAwJSB7IGJhY2tncm91bmQtcG9zaXRpb246IDAlIDUwJTsgfVxuICAgIDUwJSB7IGJhY2tncm91bmQtcG9zaXRpb246IDEwMCUgNTAlOyB9XG4gIH1cbiAgXG4gIC5oZWFkZXIge1xuICAgIG1hcmdpbi1ib3R0b206IDMwcHg7XG4gIH1cbiAgXG4gIC5oZWFkZXIgaDEge1xuICAgIGZvbnQtc2l6ZTogMzJweDtcbiAgICBmb250LXdlaWdodDogNzAwO1xuICAgIGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKTtcbiAgICBtYXJnaW46IDAgMCAxMHB4IDA7XG4gICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzY2N2VlYSwgIzc2NGJhMik7XG4gICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7XG4gICAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50O1xuICAgIGJhY2tncm91bmQtY2xpcDogdGV4dDtcbiAgfVxuICBcbiAgLmhlYWRlciBwIHtcbiAgICBmb250LXNpemU6IDE2cHg7XG4gICAgY29sb3I6ICM2YjcyODA7XG4gICAgbWFyZ2luOiAwO1xuICB9XG4gIFxuICAubW9vZC1ncmlkIHtcbiAgICBkaXNwbGF5OiBncmlkO1xuICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDMsIDFmcik7XG4gICAgZ2FwOiAyMHB4O1xuICAgIG1hcmdpbi1ib3R0b206IDMwcHg7XG4gIH1cbiAgXG4gIC5tb29kLWJ1dHRvbiB7XG4gICAgYmFja2dyb3VuZDogd2hpdGU7XG4gICAgYm9yZGVyOiAzcHggc29saWQgI2U1ZTdlYjtcbiAgICBib3JkZXItcmFkaXVzOiAxNnB4O1xuICAgIHBhZGRpbmc6IDI0cHggMTZweDtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgdHJhbnNpdGlvbjogYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKTtcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgfVxuICBcbiAgLm1vb2QtYnV0dG9uOmhvdmVyIHtcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTRweCk7XG4gICAgYm94LXNoYWRvdzogMCAxMnB4IDI0cHggcmdiYSgwLCAwLCAwLCAwLjE1KTtcbiAgICBib3JkZXItY29sb3I6IHZhcigtLXByaW1hcnktY29sb3IpO1xuICB9XG4gIFxuICAubW9vZC1idXR0b24uc2VsZWN0ZWQge1xuICAgIGJvcmRlci1jb2xvcjogdmFyKC0tc2Vjb25kYXJ5LWNvbG9yKTtcbiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjZWNmZGY1LCAjZDFmYWU1KTtcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTRweCkgc2NhbGUoMS4wNSk7XG4gICAgYm94LXNoYWRvdzogMCAxNnB4IDMycHggcmdiYSgxNiwgMTg1LCAxMjksIDAuMyk7XG4gIH1cbiAgXG4gIC5tb29kLWJ1dHRvbjo6YmVmb3JlIHtcbiAgICBjb250ZW50OiAnJztcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgdG9wOiAwO1xuICAgIGxlZnQ6IC0xMDAlO1xuICAgIHdpZHRoOiAxMDAlO1xuICAgIGhlaWdodDogMTAwJTtcbiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHRyYW5zcGFyZW50LCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNCksIHRyYW5zcGFyZW50KTtcbiAgICB0cmFuc2l0aW9uOiBsZWZ0IDAuNXM7XG4gIH1cbiAgXG4gIC5tb29kLWJ1dHRvbjpob3Zlcjo6YmVmb3JlIHtcbiAgICBsZWZ0OiAxMDAlO1xuICB9XG4gIFxuICAubW9vZC1lbW9qaSB7XG4gICAgZm9udC1zaXplOiA0OHB4O1xuICAgIG1hcmdpbi1ib3R0b206IDEycHg7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgZmlsdGVyOiBncmF5c2NhbGUoMC4zKTtcbiAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlO1xuICB9XG4gIFxuICAubW9vZC1idXR0b246aG92ZXIgLm1vb2QtZW1vamksXG4gIC5tb29kLWJ1dHRvbi5zZWxlY3RlZCAubW9vZC1lbW9qaSB7XG4gICAgZmlsdGVyOiBncmF5c2NhbGUoMCk7XG4gICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpO1xuICB9XG4gIFxuICAubW9vZC1sYWJlbCB7XG4gICAgZm9udC1zaXplOiAxNnB4O1xuICAgIGZvbnQtd2VpZ2h0OiA2MDA7XG4gICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpO1xuICAgIG1hcmdpbjogMDtcbiAgICB0ZXh0LXRyYW5zZm9ybTogY2FwaXRhbGl6ZTtcbiAgfVxuICBcbiAgLm1vb2QtZGVzY3JpcHRpb24ge1xuICAgIGZvbnQtc2l6ZTogMTJweDtcbiAgICBjb2xvcjogIzZiNzI4MDtcbiAgICBtYXJnaW46IDRweCAwIDAgMDtcbiAgICBvcGFjaXR5OiAwLjg7XG4gIH1cbiAgXG4gIC5hY3Rpb24tYnV0dG9ucyB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBnYXA6IDEycHg7XG4gICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgbWFyZ2luLXRvcDogMjBweDtcbiAgfVxuICBcbiAgLmJ0biB7XG4gICAgcGFkZGluZzogMTJweCAyNHB4O1xuICAgIGJvcmRlcjogbm9uZTtcbiAgICBib3JkZXItcmFkaXVzOiA4cHg7XG4gICAgZm9udC1zaXplOiAxNHB4O1xuICAgIGZvbnQtd2VpZ2h0OiA2MDA7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG4gIH1cbiAgXG4gIC5idG4tcHJpbWFyeSB7XG4gICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgdmFyKC0tcHJpbWFyeS1jb2xvciksICMyNTYzZWIpO1xuICAgIGNvbG9yOiB3aGl0ZTtcbiAgfVxuICBcbiAgLmJ0bi1wcmltYXJ5OmhvdmVyOm5vdCg6ZGlzYWJsZWQpIHtcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7XG4gICAgYm94LXNoYWRvdzogMCA4cHggMTZweCByZ2JhKDU5LCAxMzAsIDI0NiwgMC4zKTtcbiAgfVxuICBcbiAgLmJ0bi1zZWNvbmRhcnkge1xuICAgIGJhY2tncm91bmQ6ICNmM2Y0ZjY7XG4gICAgY29sb3I6IHZhcigtLXRleHQtY29sb3IpO1xuICAgIGJvcmRlcjogMnB4IHNvbGlkICNlNWU3ZWI7XG4gIH1cbiAgXG4gIC5idG4tc2Vjb25kYXJ5OmhvdmVyOm5vdCg6ZGlzYWJsZWQpIHtcbiAgICBiYWNrZ3JvdW5kOiAjZTVlN2ViO1xuICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTtcbiAgfVxuICBcbiAgLmJ0bjpkaXNhYmxlZCB7XG4gICAgb3BhY2l0eTogMC41O1xuICAgIGN1cnNvcjogbm90LWFsbG93ZWQ7XG4gICAgdHJhbnNmb3JtOiBub25lICFpbXBvcnRhbnQ7XG4gIH1cbiAgXG4gIC5kZXN0aW5hdGlvbi1yZXZlYWwge1xuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICB0b3A6IDA7XG4gICAgbGVmdDogMDtcbiAgICByaWdodDogMDtcbiAgICBib3R0b206IDA7XG4gICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzY2N2VlYSAwJSwgIzc2NGJhMiAxMDAlKTtcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgb3BhY2l0eTogMDtcbiAgICB0cmFuc2Zvcm06IHNjYWxlKDAuOCk7XG4gICAgdHJhbnNpdGlvbjogYWxsIDAuNnMgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKTtcbiAgICB6LWluZGV4OiAxMDtcbiAgICBib3JkZXItcmFkaXVzOiAyMHB4O1xuICAgIHBvaW50ZXItZXZlbnRzOiBub25lO1xuICB9XG4gIFxuICAuZGVzdGluYXRpb24tcmV2ZWFsLnNob3cge1xuICAgIG9wYWNpdHk6IDE7XG4gICAgdHJhbnNmb3JtOiBzY2FsZSgxKTtcbiAgICBwb2ludGVyLWV2ZW50czogYXV0bztcbiAgfVxuICBcbiAgLmRlc3RpbmF0aW9uLWNvbnRlbnQge1xuICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICBjb2xvcjogd2hpdGU7XG4gICAgbWF4LXdpZHRoOiA0MDBweDtcbiAgICBwYWRkaW5nOiAyMHB4O1xuICB9XG4gIFxuICAuZGVzdGluYXRpb24tZW1vamkge1xuICAgIGZvbnQtc2l6ZTogNjRweDtcbiAgICBtYXJnaW4tYm90dG9tOiAyMHB4O1xuICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIGFuaW1hdGlvbjogYm91bmNlIDFzIGVhc2UtaW4tb3V0O1xuICB9XG4gIFxuICBAa2V5ZnJhbWVzIGJvdW5jZSB7XG4gICAgMCUsIDIwJSwgNTAlLCA4MCUsIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH1cbiAgICA0MCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTIwcHgpOyB9XG4gICAgNjAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xMHB4KTsgfVxuICB9XG4gIFxuICAuZGVzdGluYXRpb24tdGl0bGUge1xuICAgIGZvbnQtc2l6ZTogMzJweDtcbiAgICBmb250LXdlaWdodDogNzAwO1xuICAgIG1hcmdpbjogMCAwIDE2cHggMDtcbiAgICB0ZXh0LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwgMCwgMCwgMC4zKTtcbiAgfVxuICBcbiAgLmRlc3RpbmF0aW9uLXN1YnRpdGxlIHtcbiAgICBmb250LXNpemU6IDE4cHg7XG4gICAgbWFyZ2luOiAwIDAgMjRweCAwO1xuICAgIG9wYWNpdHk6IDAuOTtcbiAgfVxuICBcbiAgLmRlc3RpbmF0aW9uLWRldGFpbHMge1xuICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xKTtcbiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCk7XG4gICAgYm9yZGVyLXJhZGl1czogMTJweDtcbiAgICBwYWRkaW5nOiAyMHB4O1xuICAgIG1hcmdpbi1ib3R0b206IDI0cHg7XG4gIH1cbiAgXG4gIC5kZXN0aW5hdGlvbi1sb2NhdGlvbiB7XG4gICAgZm9udC1zaXplOiAyNHB4O1xuICAgIGZvbnQtd2VpZ2h0OiA2MDA7XG4gICAgbWFyZ2luOiAwIDAgMTJweCAwO1xuICAgIGNvbG9yOiAjZmJiZjI0O1xuICB9XG4gIFxuICAuZGVzdGluYXRpb24tYWN0aXZpdGllcyB7XG4gICAgZm9udC1zaXplOiAxNHB4O1xuICAgIG9wYWNpdHk6IDAuOTtcbiAgICBsaW5lLWhlaWdodDogMS41O1xuICB9XG4gIFxuICAubmV3LXRyaXAtYnRuIHtcbiAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMik7XG4gICAgY29sb3I6IHdoaXRlO1xuICAgIGJvcmRlcjogMnB4IHNvbGlkIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKTtcbiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCk7XG4gIH1cbiAgXG4gIC5uZXctdHJpcC1idG46aG92ZXIge1xuICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKTtcbiAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC41KTtcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7XG4gIH1cbiAgXG4gIC5zcGFya2xlcyB7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIHRvcDogMDtcbiAgICBsZWZ0OiAwO1xuICAgIHJpZ2h0OiAwO1xuICAgIGJvdHRvbTogMDtcbiAgICBwb2ludGVyLWV2ZW50czogbm9uZTtcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xuICB9XG4gIFxuICAuc3BhcmtsZSB7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIHdpZHRoOiA0cHg7XG4gICAgaGVpZ2h0OiA0cHg7XG4gICAgYmFja2dyb3VuZDogd2hpdGU7XG4gICAgYm9yZGVyLXJhZGl1czogNTAlO1xuICAgIGFuaW1hdGlvbjogc3BhcmtsZSAycyBsaW5lYXIgaW5maW5pdGU7XG4gIH1cbiAgXG4gIEBrZXlmcmFtZXMgc3BhcmtsZSB7XG4gICAgMCUgeyBvcGFjaXR5OiAwOyB0cmFuc2Zvcm06IHNjYWxlKDApIHJvdGF0ZSgwZGVnKTsgfVxuICAgIDUwJSB7IG9wYWNpdHk6IDE7IHRyYW5zZm9ybTogc2NhbGUoMSkgcm90YXRlKDE4MGRlZyk7IH1cbiAgICAxMDAlIHsgb3BhY2l0eTogMDsgdHJhbnNmb3JtOiBzY2FsZSgwKSByb3RhdGUoMzYwZGVnKTsgfVxuICB9XG4gIFxuICAubG9hZGluZy1hbmltYXRpb24ge1xuICAgIGRpc3BsYXk6IG5vbmU7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIHRvcDogNTAlO1xuICAgIGxlZnQ6IDUwJTtcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTtcbiAgICB6LWluZGV4OiA1O1xuICB9XG4gIFxuICAubG9hZGluZy1zcGlubmVyIHtcbiAgICB3aWR0aDogNDBweDtcbiAgICBoZWlnaHQ6IDQwcHg7XG4gICAgYm9yZGVyOiA0cHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjMpO1xuICAgIGJvcmRlci10b3A6IDRweCBzb2xpZCB3aGl0ZTtcbiAgICBib3JkZXItcmFkaXVzOiA1MCU7XG4gICAgYW5pbWF0aW9uOiBzcGluIDFzIGxpbmVhciBpbmZpbml0ZTtcbiAgfVxuICBcbiAgQGtleWZyYW1lcyBzcGluIHtcbiAgICAwJSB7IHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOyB9XG4gICAgMTAwJSB7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IH1cbiAgfVxuICBcbiAgQG1lZGlhIChtYXgtd2lkdGg6IDY0MHB4KSB7XG4gICAgLm1vb2QtZ3JpZCB7XG4gICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgyLCAxZnIpO1xuICAgICAgZ2FwOiAxNnB4O1xuICAgIH1cbiAgICBcbiAgICAubW9vZC1idXR0b24ge1xuICAgICAgcGFkZGluZzogMjBweCAxMnB4O1xuICAgIH1cbiAgICBcbiAgICAubW9vZC1lbW9qaSB7XG4gICAgICBmb250LXNpemU6IDQwcHg7XG4gICAgfVxuICAgIFxuICAgIC50cmlwLXBsYW5uZXItY2FyZCB7XG4gICAgICBwYWRkaW5nOiAyNHB4O1xuICAgICAgbWFyZ2luOiAxMHB4O1xuICAgIH1cbiAgICBcbiAgICAuaGVhZGVyIGgxIHtcbiAgICAgIGZvbnQtc2l6ZTogMjRweDtcbiAgICB9XG4gIH1cbjwvc3R5bGU+XG5cbjxzY3JpcHQ+XG4gIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7XG4gIGxpbmsucmVsID0gJ3ByZWNvbm5lY3QnO1xuICBsaW5rLmhyZWYgPSAnaHR0cHM6Ly9yc21zLm1lLyc7XG4gIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQobGluayk7XG5cbiAgY29uc3QgbGluazIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7XG4gIGxpbmsyLnJlbCA9ICdzdHlsZXNoZWV0JztcbiAgbGluazIuaHJlZiA9ICdodHRwczovL3JzbXMubWUvaW50ZXIvaW50ZXIuY3NzJztcbiAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChsaW5rMik7XG48L3NjcmlwdD5cbjxhcnRpY2xlIGNsYXNzPVwibWNwLXVpLWNvbnRhaW5lclwiPlxuICA8ZGl2IGNsYXNzPVwidHJpcC1wbGFubmVyLWNhcmRcIj5cbiAgICA8ZGl2IGNsYXNzPVwiaGVhZGVyXCI+XG4gICAgICA8aDE+4pyI77iPIFBsYW4gWW91ciBQZXJmZWN0IFRyaXA8L2gxPlxuICAgICAgPHA+VGVsbCB1cyBob3cgeW91J3JlIGZlZWxpbmcsIGFuZCB3ZSdsbCBzdWdnZXN0IHRoZSBwZXJmZWN0IGRlc3RpbmF0aW9uITwvcD5cbiAgICA8L2Rpdj5cbiAgICBcbiAgICA8ZGl2IGNsYXNzPVwibW9vZC1zZWxlY3Rpb25cIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJtb29kLWdyaWRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vb2QtYnV0dG9uXCIgZGF0YS1tb29kPVwiYWR2ZW50dXJvdXNcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1vb2QtZW1vamlcIj7wn4+U77iPPC9zcGFuPlxuICAgICAgICAgIDxwIGNsYXNzPVwibW9vZC1sYWJlbFwiPkFkdmVudHVyb3VzPC9wPlxuICAgICAgICAgIDxwIGNsYXNzPVwibW9vZC1kZXNjcmlwdGlvblwiPlNlZWtpbmcgdGhyaWxscyAmIGV4Y2l0ZW1lbnQ8L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICBcbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vb2QtYnV0dG9uXCIgZGF0YS1tb29kPVwicmVsYXhlZFwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwibW9vZC1lbW9qaVwiPvCfj5bvuI88L3NwYW4+XG4gICAgICAgICAgPHAgY2xhc3M9XCJtb29kLWxhYmVsXCI+UmVsYXhlZDwvcD5cbiAgICAgICAgICA8cCBjbGFzcz1cIm1vb2QtZGVzY3JpcHRpb25cIj5OZWVkIHBlYWNlICYgdHJhbnF1aWxpdHk8L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICBcbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vb2QtYnV0dG9uXCIgZGF0YS1tb29kPVwiY3VsdHVyYWxcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1vb2QtZW1vamlcIj7wn4+b77iPPC9zcGFuPlxuICAgICAgICAgIDxwIGNsYXNzPVwibW9vZC1sYWJlbFwiPkN1bHR1cmFsPC9wPlxuICAgICAgICAgIDxwIGNsYXNzPVwibW9vZC1kZXNjcmlwdGlvblwiPkV4cGxvcmUgaGlzdG9yeSAmIHRyYWRpdGlvbnM8L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICBcbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vb2QtYnV0dG9uXCIgZGF0YS1tb29kPVwicm9tYW50aWNcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1vb2QtZW1vamlcIj7wn5KVPC9zcGFuPlxuICAgICAgICAgIDxwIGNsYXNzPVwibW9vZC1sYWJlbFwiPlJvbWFudGljPC9wPlxuICAgICAgICAgIDxwIGNsYXNzPVwibW9vZC1kZXNjcmlwdGlvblwiPkxvdmUgaXMgaW4gdGhlIGFpcjwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIFxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9vZC1idXR0b25cIiBkYXRhLW1vb2Q9XCJmb29kaWVcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1vb2QtZW1vamlcIj7wn42cPC9zcGFuPlxuICAgICAgICAgIDxwIGNsYXNzPVwibW9vZC1sYWJlbFwiPkZvb2RpZTwvcD5cbiAgICAgICAgICA8cCBjbGFzcz1cIm1vb2QtZGVzY3JpcHRpb25cIj5DdWxpbmFyeSBhZHZlbnR1cmVzIGF3YWl0PC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgXG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb29kLWJ1dHRvblwiIGRhdGEtbW9vZD1cInBhcnR5XCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJtb29kLWVtb2ppXCI+8J+OiTwvc3Bhbj5cbiAgICAgICAgICA8cCBjbGFzcz1cIm1vb2QtbGFiZWxcIj5QYXJ0eTwvcD5cbiAgICAgICAgICA8cCBjbGFzcz1cIm1vb2QtZGVzY3JpcHRpb25cIj5SZWFkeSB0byBjZWxlYnJhdGUgbGlmZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIFxuICAgICAgPGRpdiBjbGFzcz1cImFjdGlvbi1idXR0b25zXCI+XG4gICAgICAgIDxidXR0b24gaWQ9XCJjbGVhci1tb29kXCIgY2xhc3M9XCJidG4gYnRuLXNlY29uZGFyeVwiIGRpc2FibGVkIG9uY2xpY2s9XCJjbGVhck1vb2QoKVwiPlxuICAgICAgICAgIENsZWFyIFNlbGVjdGlvblxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPGJ1dHRvbiBpZD1cInBsYW4tdHJpcFwiIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5XCIgZGlzYWJsZWQgb25jbGljaz1cInBsYW5UcmlwKClcIj5cbiAgICAgICAgICBQbGFuIE15IFRyaXAhIOKcqFxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIFxuICAgIDxkaXYgY2xhc3M9XCJsb2FkaW5nLWFuaW1hdGlvblwiIGlkPVwibG9hZGluZ1wiPlxuICAgICAgPGRpdiBjbGFzcz1cImxvYWRpbmctc3Bpbm5lclwiPjwvZGl2PlxuICAgIDwvZGl2PlxuICAgIFxuICAgIDxkaXYgY2xhc3M9XCJkZXN0aW5hdGlvbi1yZXZlYWxcIiBpZD1cImRlc3RpbmF0aW9uLXJldmVhbFwiPlxuICAgICAgPGRpdiBjbGFzcz1cInNwYXJrbGVzXCIgaWQ9XCJzcGFya2xlc1wiPjwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cImRlc3RpbmF0aW9uLWNvbnRlbnRcIj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJkZXN0aW5hdGlvbi1lbW9qaVwiIGlkPVwiZGVzdGluYXRpb24tZW1vamlcIj7wn4yfPC9zcGFuPlxuICAgICAgICA8aDIgY2xhc3M9XCJkZXN0aW5hdGlvbi10aXRsZVwiPllvdXIgUGVyZmVjdCBEZXN0aW5hdGlvbjwvaDI+XG4gICAgICAgIDxwIGNsYXNzPVwiZGVzdGluYXRpb24tc3VidGl0bGVcIiBpZD1cImRlc3RpbmF0aW9uLXN1YnRpdGxlXCI+QmFzZWQgb24geW91ciBtb29kLi4uPC9wPlxuICAgICAgICBcbiAgICAgICAgPGRpdiBjbGFzcz1cImRlc3RpbmF0aW9uLWRldGFpbHNcIj5cbiAgICAgICAgICA8cCBjbGFzcz1cImRlc3RpbmF0aW9uLWxvY2F0aW9uXCIgaWQ9XCJkZXN0aW5hdGlvbi1sb2NhdGlvblwiPkxvYWRpbmcuLi48L3A+XG4gICAgICAgICAgPHAgY2xhc3M9XCJkZXN0aW5hdGlvbi1hY3Rpdml0aWVzXCIgaWQ9XCJkZXN0aW5hdGlvbi1hY3Rpdml0aWVzXCI+RGlzY292ZXJpbmcgYW1hemluZyBhY3Rpdml0aWVzLi4uPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgXG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gbmV3LXRyaXAtYnRuXCIgb25jbGljaz1cInN0YXJ0T3ZlcigpXCI+XG4gICAgICAgICAgUGxhbiBBbm90aGVyIFRyaXAg8J+Xuu+4j1xuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvYXJ0aWNsZT5cblxuPHNjcmlwdD5cbiAgY29uc3QgbWNwVWlDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWNwLXVpLWNvbnRhaW5lcicpO1xuICBcbiAgZnVuY3Rpb24gcG9zdFNpemUoKSB7XG4gICAgY29uc3QgaGVpZ2h0ID0gbWNwVWlDb250YWluZXIuc2Nyb2xsSGVpZ2h0O1xuICAgIGNvbnN0IHdpZHRoID0gbWNwVWlDb250YWluZXIuc2Nyb2xsV2lkdGg7XG4gICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZShcbiAgICAgIHtcbiAgICAgICAgdHlwZTogXCJ1aS1zaXplLWNoYW5nZVwiLFxuICAgICAgICBwYXlsb2FkOiB7XG4gICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgd2lkdGg6IHdpZHRoLCBcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBcIipcIixcbiAgICApO1xuICB9XG5cbiAgLy8gQ3JlYXRlIFJlc2l6ZU9ic2VydmVyIHRvIHdhdGNoIGZvciBzaXplIGNoYW5nZXNcbiAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKGVudHJpZXMpID0+IHtcbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgIC8vIFBvc3Qgc2l6ZSB3aGVuZXZlciBkb2N1bWVudCBzaXplIGNoYW5nZXNcbiAgICAgIHBvc3RTaXplKCk7XG4gICAgfVxuICB9KTtcblxuICAvLyBTdGFydCBvYnNlcnZpbmcgdGhlIG1jcC11aS1jb250YWluZXIgZWxlbWVudFxuICByZXNpemVPYnNlcnZlci5vYnNlcnZlKG1jcFVpQ29udGFpbmVyKTtcbjwvc2NyaXB0PlxuPHNjcmlwdD5cbiAgbGV0IHNlbGVjdGVkTW9vZCA9IG51bGw7XG4gIGNvbnN0IG1vb2REZXN0aW5hdGlvbnMgPSB7XCJhZHZlbnR1cm91c1wiOntcImRlc3RpbmF0aW9uc1wiOltcIk5ldyBaZWFsYW5kXCIsXCJDb3N0YSBSaWNhXCIsXCJJY2VsYW5kXCIsXCJOZXBhbFwiLFwiUGF0YWdvbmlhXCJdLFwiYWN0aXZpdGllc1wiOltcIkJ1bmdlZSBqdW1waW5nXCIsXCJWb2xjYW5vIGhpa2luZ1wiLFwiR2xhY2llciB3YWxraW5nXCIsXCJNb3VudGFpbiBjbGltYmluZ1wiLFwiV2lsZGxpZmUgc2FmYXJpXCJdfSxcInJlbGF4ZWRcIjp7XCJkZXN0aW5hdGlvbnNcIjpbXCJNYWxkaXZlc1wiLFwiQmFsaVwiLFwiU2FudG9yaW5pXCIsXCJUdXNjYW55XCIsXCJGaWppXCJdLFwiYWN0aXZpdGllc1wiOltcIkJlYWNoIGxvdW5naW5nXCIsXCJTcGEgdHJlYXRtZW50c1wiLFwiV2luZSB0YXN0aW5nXCIsXCJTdW5zZXQgd2F0Y2hpbmdcIixcIk1lZGl0YXRpb24gcmV0cmVhdHNcIl19LFwiY3VsdHVyYWxcIjp7XCJkZXN0aW5hdGlvbnNcIjpbXCJKYXBhblwiLFwiTW9yb2Njb1wiLFwiSW5kaWFcIixcIlBlcnVcIixcIkVneXB0XCJdLFwiYWN0aXZpdGllc1wiOltcIlRlbXBsZSB2aXNpdHNcIixcIkxvY2FsIGNvb2tpbmcgY2xhc3Nlc1wiLFwiQXJ0IGdhbGxlcmllc1wiLFwiSGlzdG9yaWNhbCB0b3Vyc1wiLFwiVHJhZGl0aW9uYWwgZmVzdGl2YWxzXCJdfSxcInJvbWFudGljXCI6e1wiZGVzdGluYXRpb25zXCI6W1wiUGFyaXNcIixcIlZlbmljZVwiLFwiS3lvdG9cIixcIlByYWd1ZVwiLFwiU2FudG9yaW5pXCJdLFwiYWN0aXZpdGllc1wiOltcIkNhbmRsZWxpdCBkaW5uZXJzXCIsXCJTdW5zZXQgY3J1aXNlc1wiLFwiQ291cGxlcyBzcGFcIixcIldpbmUgdG91cnNcIixcIkhpc3RvcmljIHdhbGtzXCJdfSxcImZvb2RpZVwiOntcImRlc3RpbmF0aW9uc1wiOltcIkl0YWx5XCIsXCJUaGFpbGFuZFwiLFwiTWV4aWNvXCIsXCJGcmFuY2VcIixcIlZpZXRuYW1cIl0sXCJhY3Rpdml0aWVzXCI6W1wiU3RyZWV0IGZvb2QgdG91cnNcIixcIkNvb2tpbmcgY2xhc3Nlc1wiLFwiV2luZSB0YXN0aW5nc1wiLFwiTWFya2V0IHZpc2l0c1wiLFwiTWljaGVsaW4gZGluaW5nXCJdfSxcInBhcnR5XCI6e1wiZGVzdGluYXRpb25zXCI6W1wiSWJpemFcIixcIkxhcyBWZWdhc1wiLFwiUmlvIGRlIEphbmVpcm9cIixcIkJhbmdrb2tcIixcIkJlcmxpblwiXSxcImFjdGl2aXRpZXNcIjpbXCJCZWFjaCBjbHVic1wiLFwiUm9vZnRvcCBiYXJzXCIsXCJNdXNpYyBmZXN0aXZhbHNcIixcIk5pZ2h0IG1hcmtldHNcIixcIkRhbmNlIGNsdWJzXCJdfX07XG4gIFxuICBjb25zdCBtb29kRW1vamlzID0ge1xuICAgIGFkdmVudHVyb3VzOiAn8J+PlO+4jycsXG4gICAgcmVsYXhlZDogJ/Cfj5bvuI8nLCBcbiAgICBjdWx0dXJhbDogJ/Cfj5vvuI8nLFxuICAgIHJvbWFudGljOiAn8J+SlScsXG4gICAgZm9vZGllOiAn8J+NnCcsXG4gICAgcGFydHk6ICfwn46JJ1xuICB9O1xuXG4gIGZ1bmN0aW9uIHNlbGVjdE1vb2QobW9vZCkge1xuICAgIHNlbGVjdGVkTW9vZCA9IG1vb2Q7XG4gICAgXG4gICAgLy8gVXBkYXRlIFVJXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vb2QtYnV0dG9uJykuZm9yRWFjaChidXR0b24gPT4ge1xuICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7XG4gICAgfSk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtbW9vZD1cIicgKyBtb29kICsgJ1wiXScpLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgXG4gICAgLy8gRW5hYmxlIGJ1dHRvbnNcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItbW9vZCcpLmRpc2FibGVkID0gZmFsc2U7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYW4tdHJpcCcpLmRpc2FibGVkID0gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBjbGVhck1vb2QoKSB7XG4gICAgc2VsZWN0ZWRNb29kID0gbnVsbDtcbiAgICBcbiAgICAvLyBVcGRhdGUgVUlcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW9vZC1idXR0b24nKS5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgICBidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBEaXNhYmxlIGJ1dHRvbnNcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItbW9vZCcpLmRpc2FibGVkID0gdHJ1ZTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhbi10cmlwJykuZGlzYWJsZWQgPSB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxhblRyaXAoKSB7XG4gICAgaWYgKCFzZWxlY3RlZE1vb2QpIHJldHVybjtcbiAgICBcbiAgICAvLyBTaG93IGxvYWRpbmcgYW5pbWF0aW9uXG4gICAgY29uc3QgbG9hZGluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nJyk7XG4gICAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICBcbiAgICAvLyBIaWRlIG1vb2Qgc2VsZWN0aW9uIHRlbXBvcmFyaWx5XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vb2Qtc2VsZWN0aW9uJykuc3R5bGUub3BhY2l0eSA9ICcwLjMnO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb29kLXNlbGVjdGlvbicpLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7XG4gICAgXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAvLyBIaWRlIGxvYWRpbmdcbiAgICAgIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgIFxuICAgICAgLy8gR2V0IHJhbmRvbSBkZXN0aW5hdGlvbiBhbmQgYWN0aXZpdGllcyBmb3IgdGhlIG1vb2RcbiAgICAgIGNvbnN0IG1vb2REYXRhID0gbW9vZERlc3RpbmF0aW9uc1tzZWxlY3RlZE1vb2RdO1xuICAgICAgY29uc3QgcmFuZG9tRGVzdGluYXRpb24gPSBtb29kRGF0YS5kZXN0aW5hdGlvbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbW9vZERhdGEuZGVzdGluYXRpb25zLmxlbmd0aCldO1xuICAgICAgY29uc3QgcmFuZG9tQWN0aXZpdGllcyA9IG1vb2REYXRhLmFjdGl2aXRpZXMuc2xpY2UoMCwgMykuam9pbignLCAnKTtcbiAgICAgIFxuICAgICAgLy8gVXBkYXRlIGRlc3RpbmF0aW9uIHJldmVhbCBjb250ZW50XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVzdGluYXRpb24tZW1vamknKS50ZXh0Q29udGVudCA9IG1vb2RFbW9qaXNbc2VsZWN0ZWRNb29kXTtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXN0aW5hdGlvbi1zdWJ0aXRsZScpLnRleHRDb250ZW50ID0gJ1BlcmZlY3QgZm9yIHlvdXIgJyArIHNlbGVjdGVkTW9vZCArICcgbW9vZCEnO1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc3RpbmF0aW9uLWxvY2F0aW9uJykudGV4dENvbnRlbnQgPSByYW5kb21EZXN0aW5hdGlvbjtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXN0aW5hdGlvbi1hY3Rpdml0aWVzJykudGV4dENvbnRlbnQgPSAnRW5qb3k6ICcgKyByYW5kb21BY3Rpdml0aWVzO1xuICAgICAgXG4gICAgICAvLyBDcmVhdGUgc3BhcmtsZXNcbiAgICAgIGNyZWF0ZVNwYXJrbGVzKCk7XG4gICAgICBcbiAgICAgIC8vIFNob3cgZGVzdGluYXRpb24gcmV2ZWFsIHdpdGggYW5pbWF0aW9uXG4gICAgICBjb25zdCByZXZlYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVzdGluYXRpb24tcmV2ZWFsJyk7XG4gICAgICByZXZlYWwuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICAgICAgXG4gICAgICAvLyBTZW5kIG1lc3NhZ2UgdG8gcGFyZW50XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgdHlwZTogJ3Rvb2wnLFxuICAgICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICAgIHRvb2xOYW1lOiAnbW9vZC10cmlwLXBsYW5uZXInLFxuICAgICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICAgIG1vb2Q6IHNlbGVjdGVkTW9vZCxcbiAgICAgICAgICAgICAgZGVzdGluYXRpb246IHJhbmRvbURlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICBhY3Rpdml0aWVzOiBtb29kRGF0YS5hY3Rpdml0aWVzLnNsaWNlKDAsIDMpLFxuICAgICAgICAgICAgICBjb25maXJtZWQ6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sICcqJyk7XG4gICAgICB9LCAxMDAwKTtcbiAgICAgIFxuICAgIH0sIDIwMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RhcnRPdmVyKCkge1xuICAgIC8vIEhpZGUgZGVzdGluYXRpb24gcmV2ZWFsXG4gICAgY29uc3QgcmV2ZWFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc3RpbmF0aW9uLXJldmVhbCcpO1xuICAgIHJldmVhbC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgXG4gICAgLy8gUmVzZXQgbW9vZCBzZWxlY3Rpb25cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNsZWFyTW9vZCgpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vb2Qtc2VsZWN0aW9uJykuc3R5bGUub3BhY2l0eSA9ICcxJztcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb29kLXNlbGVjdGlvbicpLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnYXV0byc7XG4gICAgICBcbiAgICAgIC8vIENsZWFyIHNwYXJrbGVzXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3BhcmtsZXMnKS5pbm5lckhUTUwgPSAnJztcbiAgICB9LCA2MDApO1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlU3BhcmtsZXMoKSB7XG4gICAgY29uc3Qgc3BhcmtsZXNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3BhcmtsZXMnKTtcbiAgICBzcGFya2xlc0NvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDIwOyBpKyspIHtcbiAgICAgIGNvbnN0IHNwYXJrbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHNwYXJrbGUuY2xhc3NOYW1lID0gJ3NwYXJrbGUnO1xuICAgICAgc3BhcmtsZS5zdHlsZS5sZWZ0ID0gTWF0aC5yYW5kb20oKSAqIDEwMCArICclJztcbiAgICAgIHNwYXJrbGUuc3R5bGUudG9wID0gTWF0aC5yYW5kb20oKSAqIDEwMCArICclJztcbiAgICAgIHNwYXJrbGUuc3R5bGUuYW5pbWF0aW9uRGVsYXkgPSBNYXRoLnJhbmRvbSgpICogMiArICdzJztcbiAgICAgIHNwYXJrbGVzQ29udGFpbmVyLmFwcGVuZENoaWxkKHNwYXJrbGUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFkZCBldmVudCBsaXN0ZW5lcnMgd2hlbiBET00gaXMgcmVhZHlcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkge1xuICAgIC8vIEFkZCBjbGljayBsaXN0ZW5lcnMgdG8gbW9vZCBidXR0b25zXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vb2QtYnV0dG9uJykuZm9yRWFjaChidXR0b24gPT4ge1xuICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IG1vb2QgPSB0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS1tb29kJyk7XG4gICAgICAgIHNlbGVjdE1vb2QobW9vZCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBjbGljayBsaXN0ZW5lcnMgdG8gYWN0aW9uIGJ1dHRvbnNcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItbW9vZCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xlYXJNb29kKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhbi10cmlwJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwbGFuVHJpcCk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ldy10cmlwLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3RhcnRPdmVyKTtcbiAgfSk7XG48L3NjcmlwdD4ifV0='
        }
      ]);
      expect(artifacts).toEqual(undefined);
    });
  });
});
